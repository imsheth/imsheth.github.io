---
title: "The Hows - OpenAI with node.js using chat completion API and assistants API"
description: "This post is focused on using node.js to integrate with OpenAI chat completion API and assistants API"
image: /posts/airflow2-dockeroperator-nodejs-gitlab/airflow2-dockeroperator-nodejs-gitlab-banner.png
disableTableOfContents: false
---

`Oct 17, 2024`

<blockquote>
  <p style="text-align:center">
    The motivation for writing this post is that it provides a single concise
    starting point to explore OpenAI with node.js.
  </p>
</blockquote>

This post is focused on using node.js 19.6.0 to integrate with openai 4.68.0 package with chat completion API and assistants API

<a
  href="https://github.com/imsheth/openai-nodejs"
  target="_blank"
  rel="noopener noreferrer"
>
  The relevant source code for the post can be found here
</a>
<br />
<br />

---

## OpenAI 4.68.0

- <a href="https://openai.com/" target="_blank" rel="noopener noreferrer">
    OpenAI
  </a> is the organization that created <a
    href="https://platform.openai.com/docs/models"
    target="_blank"
    rel="noopener noreferrer"
  >
    generative AI models
  </a> and packaged it into a product called <a
    href="https://chat.openai.com/"
    target="_blank"
    rel="noopener noreferrer"
  >
    ChatGPT
  </a>
- Using <a href="https://chat.openai.com/" target="_blank" rel="noopener noreferrer" > ChatGPT </a> is free (ChatGPT Plus and ChatGPT Team are paid) but using <a href="https://community.openai.com/t/is-playground-free/18909/14" target="_blank" rel="noopener noreferrer" > OpenAI playground </a> is not after you exhaust your free credits (if any)
- We'll be using <a href="https://www.npmjs.com/package/openai" target="_blank" rel="noopener noreferrer" > OpenAI Node API Library openai 4.68.0 </a>

1. <a
     href="https://platform.openai.com/docs/overview"
     target="_blank"
     rel="noopener noreferrer"
   >
     Sign up for an OpenAI account
   </a>
2. <a
     href="https://platform.openai.com/settings/organization/billing/overview"
     target="_blank"
     rel="noopener noreferrer"
   >
     Add payment method and add credits to balance
   </a>
3. <a
     href="https://platform.openai.com/api-keys"
     target="_blank"
     rel="noopener noreferrer"
   >
     Create new secret key and copy it
   </a>

   - For the "Owned by"

     - <b>You</b> is better for personal use and if you're going to be the only person
       making API calls. This API key is tied to your user and can make requests
       against the selected project. If you are removed from the organization or
       project, this key will be disabled. The "Permissions" setting lets you adjust
       the permissions and granularity the key will have.

     - <b>Service account</b> is for organizational use and adds more security layers,
       so it's suitable for programmatic API calls through the app/system you're
       building. This API key is not tied to your user and can make requests against
       the selected project. If you are removed from the organization or project,
       this key will not be disabled.

<a href="/posts/openai-nodejs/1.png" target="_blank" rel="noopener noreferrer">
  <img
    src="/posts/openai-nodejs/1.png"
    alt="openai-nodejs-1-png"
    align="left"
    style="margin-right: 2rem; margin-bottom: 1rem"
  />
</a>

<a href="/posts/openai-nodejs/2.png" target="_blank" rel="noopener noreferrer">
  <img
    src="/posts/openai-nodejs/2.png"
    alt="openai-nodejs-1-png"
    align="left"
    style="margin-right: 2rem; margin-bottom: 1rem"
  />
</a>

<a href="/posts/openai-nodejs/3.png" target="_blank" rel="noopener noreferrer">
  <img
    src="/posts/openai-nodejs/3.png"
    alt="openai-nodejs-1-png"
    align="left"
    style="margin-right: 2rem; margin-bottom: 1rem"
  />
</a>

4. Export the API key

```shell
export OPENAI_API_KEY="<your_api_key_here>"
```

## node.js 19.6.0

1. Initialize project, install packages, create server file and assign environment variable for server port

```shell
mkdir server && cd server && npm init -y && npm install --save express body-parser openai && touch index.js && export OPENAI_API_SERVER_PORT=8080
```

2. Add the following line to `package.json` <a href="https://nodejs.org/api/packages.html#determining-module-system" target="_blank" rel="noopener noreferrer" > to make the server file an ES module</a>

```shell
"type": "module",
```

3. Below `node.js` code exposes `POST /text_generation/chat_completions` endpoint that in-turn calls OpenAI API

```javascript
// Import packages
import express from "express";
import bodyParser from "body-parser";
import OpenAI from "openai";

// Initialize
const app = express();
const port = process.env["OPENAI_API_SERVER_PORT"];
const openai = new OpenAI();

// Parse incoming requests with JSON payloads
// Body parser is a middleware for Node.js that parses incoming request bodies and makes them available as objects in the req.body property
// https://medium.com/@amirakhaled2027/body-parser-middleware-in-node-js-75b6b9a36613
app.use(bodyParser.json());

// Setup server on specified port
app.listen(port, () => {
  console.log(`Server listening on port ${port}`);
});

// POST /text_generation/chat_completions that calls OpenAI API
app.post("/text_generation/chat_completions", async (request, response) => {
  const { chats } = request.body;

  const result = await openai.chat.completions.create({
    model: "gpt-3.5-turbo",
    messages: [
      { role: "system", content: "You are a texas cowboy." },
      ...chats,
    ],
  });

  response.json({
    output: result.choices[0].message,
  });
});
```

4. Run the server and test the `POST /text_generation/chat_completions` endpoint

```shell
node index.js
```

<a href="/posts/openai-nodejs/4.png" target="_blank" rel="noopener noreferrer">
  <img
    src="/posts/openai-nodejs/4.png"
    alt="openai-nodejs-1-png"
    align="left"
    style="margin-right: 2rem; margin-bottom: 1rem"
  />
</a>

<a href="/posts/openai-nodejs/5.png" target="_blank" rel="noopener noreferrer">
  <img
    src="/posts/openai-nodejs/5.png"
    alt="openai-nodejs-1-png"
    align="left"
    style="margin-right: 2rem; margin-bottom: 1rem"
  />
</a>

`#openai` `#nodejs` `#tech`

---

<div style="text-align: left; margin-top: 0.55rem; margin-bottom: 0.40rem;">
  <a
    href="https://twitter.com/theimsheth"
    target="_blank"
    rel="noopener noreferrer"
    style="text-decoration:none;"
  >
    <img
      src="/social/twitter.svg"
      alt="twitter"
      style="height: 32px; width: 32px; margin: .2rem"
    />
  </a>
  <a
    href="https://github.com/imsheth"
    target="_blank"
    rel="noopener noreferrer"
    style="text-decoration:none;"
  >
    <img
      src="/social/github.svg"
      alt="github"
      style="height: 32px; width: 32px; margin: .2rem"
    />
  </a>
  <a
    href="https://www.npmjs.com/~imsheth"
    target="_blank"
    rel="noopener noreferrer"
    style="text-decoration:none;"
  >
    <img
      src="/social/npm.svg"
      alt="npm"
      style="height: 32px; width: 32px; margin: .2rem"
    />
  </a>
  <a
    href="https://stackoverflow.com/users/3152654/imsheth?tab=profile"
    target="_blank"
    rel="noopener noreferrer"
    style="text-decoration:none;"
  >
    <img
      src="/social/stackoverflow.svg"
      alt="stackoverflow"
      style="height: 32px; width: 32px; margin: .2rem"
    />
  </a>
  <a
    href="https://in.linkedin.com/in/imsheth"
    target="_blank"
    rel="noopener noreferrer"
    style="text-decoration:none;"
  >
    <img
      src="/social/linkedin.svg"
      alt="linkedin"
      style="height: 32px; width: 32px; margin: .2rem"
    />
  </a>
  <a
    href="https://instagram.com/imsheth/"
    target="_blank"
    rel="noopener noreferrer"
    style="text-decoration:none;"
  >
    <img
      src="/social/instagram.svg"
      alt="instagram"
      style="height: 32px; width: 32px; margin: .2rem"
    />
  </a>
  <a
    href="https://www.facebook.com/imsheth"
    target="_blank"
    rel="noopener noreferrer"
    style="text-decoration:none;"
  >
    <img
      src="/social/facebook.svg"
      alt="facebook"
      style="height: 32px; width: 32px; margin: .2rem"
    />
  </a>
  <a
    href="https://open.spotify.com/user/orekqqr23uij1ehi7upg9akat?si=xXA0ZUqxQW2GgFYzdXgAOA&nd=1"
    target="_blank"
    rel="noopener noreferrer"
    style="text-decoration:none;"
  >
    <img
      src="/social/spotify.svg"
      alt="spotify"
      style="height: 32px; width: 32px; margin: .2rem"
    />
  </a>
  <a
    href="https://www.tvshowtime.com/1589595"
    target="_blank"
    rel="noopener noreferrer"
    style="text-decoration:none;"
  >
    <img
      src="/social/tvtime.svg"
      alt="tvshowtime"
      style="height: 32px; width: 32px; margin: .2rem"
    />
  </a>
</div>

---

<br />

import Giscus from "@giscus/react";

<Giscus
  id="comments"
  repo="imsheth/imsheth.github.io"
  repoId="MDEwOlJlcG9zaXRvcnk2Mjg4MDczMw=="
  category="Announcements"
  categoryId="DIC_kwDOA7973c4CP60t"
  mapping="url"
  term="Welcome to @giscus/react component!"
  reactionsEnabled="1"
  emitMetadata="1"
  inputPosition="top"
  theme="light"
  lang="en"
  loading="lazy"
/>
