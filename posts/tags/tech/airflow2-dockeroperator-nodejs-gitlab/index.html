<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="generator" content="Gatsby 3.6.1"/><style type="text/css">
    .anchor.before {
      position: absolute;
      top: 0;
      left: 0;
      transform: translateX(-100%);
      padding-right: 4px;
    }
    .anchor.after {
      display: inline-block;
      padding-left: 4px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop
          var clientTop = document.documentElement.clientTop || document.body.clientTop || 0
          var offset = element.getBoundingClientRect().top + scrollTop - clientTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><title data-react-helmet="true">The Hows - Apache Airflow 2 using DockerOperator with node.js and Gitlab container registry on Ubuntu 20 | Ishan Sheth (imsheth)</title><meta data-react-helmet="true" name="description" content="This post is focused on how to setup Apache Airflow 2 using DockerOperator with node.js and Gitlab container registry on Ubuntu 20"/><meta data-react-helmet="true" name="image" content="https://imsheth.com/posts/airflow2-dockeroperator-nodejs-gitlab/airflow2-dockeroperator-nodejs-gitlab-banner.png"/><meta data-react-helmet="true" http-equiv="x-ua-compatible" content="IE=edge,chrome=1"/><meta data-react-helmet="true" name="MobileOptimized" content="320"/><meta data-react-helmet="true" name="HandheldFriendly" content="True"/><meta data-react-helmet="true" name="google" content="notranslate"/><meta data-react-helmet="true" name="referrer" content="no-referrer-when-downgrade"/><meta data-react-helmet="true" property="og:url" content="https://imsheth.com/posts/tags/tech/airflow2-dockeroperator-nodejs-gitlab/"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" property="og:title" content="The Hows - Apache Airflow 2 using DockerOperator with node.js and Gitlab container registry on Ubuntu 20 | Ishan Sheth (imsheth)"/><meta data-react-helmet="true" property="og:description" content="This post is focused on how to setup Apache Airflow 2 using DockerOperator with node.js and Gitlab container registry on Ubuntu 20"/><meta data-react-helmet="true" property="og:locale" content="en"/><meta data-react-helmet="true" property="og:site_name" content="Ishan Sheth (imsheth)"/><meta data-react-helmet="true" property="og:image" content="https://imsheth.com/posts/airflow2-dockeroperator-nodejs-gitlab/airflow2-dockeroperator-nodejs-gitlab-banner.png"/><meta data-react-helmet="true" property="og:image:secure_url" content="https://imsheth.com/posts/airflow2-dockeroperator-nodejs-gitlab/airflow2-dockeroperator-nodejs-gitlab-banner.png"/><meta data-react-helmet="true" property="og:image:alt" content="Banner"/><meta data-react-helmet="true" property="og:image:type" content="image/png"/><meta data-react-helmet="true" property="og:image:width" content="1200"/><meta data-react-helmet="true" property="og:image:height" content="630"/><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"/><meta data-react-helmet="true" name="twitter:title" content="The Hows - Apache Airflow 2 using DockerOperator with node.js and Gitlab container registry on Ubuntu 20 | Ishan Sheth (imsheth)"/><meta data-react-helmet="true" name="twitter:site" content="@theimsheth"/><meta data-react-helmet="true" name="twitter:creator" content="@theimsheth"/><meta data-react-helmet="true" name="twitter:image" content="https://imsheth.com/posts/airflow2-dockeroperator-nodejs-gitlab/airflow2-dockeroperator-nodejs-gitlab-banner.png"/><meta data-react-helmet="true" name="twitter:image:src" content="https://imsheth.com/posts/airflow2-dockeroperator-nodejs-gitlab/airflow2-dockeroperator-nodejs-gitlab-banner.png"/><meta data-react-helmet="true" name="twitter:image:alt" content="Banner"/><meta data-react-helmet="true" name="twitter:image:width" content="1200"/><meta data-react-helmet="true" name="twitter:image:height" content="630"/><script data-react-helmet="true" type="application/ld+json">[{"@context":"http://schema.org","@type":"WebSite","url":"https://imsheth.com/posts/tags/tech/airflow2-dockeroperator-nodejs-gitlab/","name":"The Hows - Apache Airflow 2 using DockerOperator with node.js and Gitlab container registry on Ubuntu 20","alternateName":"Ishan Sheth (imsheth)"}]</script><link rel="icon" href="/favicon-32x32.png?v=e7438710055211eb6d9ad2771ee66600" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><meta name="theme-color" content="#231F20"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=e7438710055211eb6d9ad2771ee66600"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=e7438710055211eb6d9ad2771ee66600"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=e7438710055211eb6d9ad2771ee66600"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=e7438710055211eb6d9ad2771ee66600"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=e7438710055211eb6d9ad2771ee66600"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=e7438710055211eb6d9ad2771ee66600"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=e7438710055211eb6d9ad2771ee66600"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=e7438710055211eb6d9ad2771ee66600"/><link rel="sitemap" type="application/xml" href="/sitemap.xml"/><link rel="preconnect" href="https://www.google-analytics.com"/><link rel="dns-prefetch" href="https://www.google-analytics.com"/><link rel="canonical" href="https://imsheth.com/posts/tags/tech/airflow2-dockeroperator-nodejs-gitlab" data-baseprotocol="https:" data-basehost="imsheth.com"/><link as="script" rel="preload" href="/webpack-runtime-06b2d0ff5ad089d23a10.js"/><link as="script" rel="preload" href="/framework-b46a6925e6a7b8d3b87f.js"/><link as="script" rel="preload" href="/f0e45107-c14585455e99ce9e9e51.js"/><link as="script" rel="preload" href="/app-604b17e51c593e9714e6.js"/><link as="script" rel="preload" href="/545f34e4-2b9fd36d84b7bf8ea9b9.js"/><link as="script" rel="preload" href="/5e2a4920-9d393d3fc1d166c1df23.js"/><link as="script" rel="preload" href="/252f366e-60c4f5aff3b5bf89cf6c.js"/><link as="script" rel="preload" href="/a7629950cb7a18c7593baf47d0acfe798f1cddc4-39eb6eaf15cd62012732.js"/><link as="script" rel="preload" href="/component---node-modules-rocketseat-gatsby-theme-docs-core-src-templates-docs-query-js-c880f3a4d9d09789db84.js"/><link as="fetch" rel="preload" href="/page-data/posts/tags/tech/airflow2-dockeroperator-nodejs-gitlab/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/1954253342.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/2328931024.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/2501019404.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/973074209.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><style data-emotion="css-global 3gwfsf">*,*::after,*::before{margin:0;padding:0;box-sizing:border-box;}body{font-size:16px;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Oxygen,Ubuntu,Cantarell,'Open Sans','Helvetica Neue',sans-serif;background-color:#FFFFFF;text-rendering:optimizelegibility;-webkit-font-smoothing:antialiased;overflow-y:scroll;}h1{font-size:32px;color:#3D3D4D;font-weight:bold;margin-bottom:24px;}h2{font-size:24px;}h3{font-size:18px;}h4{font-size:16px;}h2,h3,h4,h5,h6{color:#3D3D4D;margin:24px 0 16px 0;font-weight:bold;}p{color:#6C6C80;font-size:16px;line-height:28px;margin-bottom:16px;font-weight:400;}code.inline-code{display:inline-block;vertical-align:middle;line-height:1;padding:0.2em;background-color:#44475a;color:rgba(248, 248, 242);font-size:14px;border-radius:3px;font-feature-settings:'clig' 0,'calt' 0;font-variant:no-common-ligatures no-discretionary-ligatures no-historical-ligatures no-contextual;}h1 code.inline-code,h2 code.inline-code{font-size:calc(100% - 5px);padding:4px;}a{color:#6C6C80;font-weight:bold;-webkit-text-decoration:none;text-decoration:none;}a:hover{-webkit-text-decoration:underline;text-decoration:underline;}blockquote{margin-bottom:16px;width:100%;}blockquote p{padding:1rem;border-radius:5px;background:#feebc8;color:#2d3748;margin:0;}blockquote p a{color:#2d3748;}hr{border:0;height:0;border-top:1px solid rgba(0, 0, 0, 0.1);border-bottom:1px solid rgba(255, 255, 255, 0.3);}table{border-collapse:separate;border-spacing:0 4px;margin-top:-4px;margin-bottom:16px;width:100%;}table th,table td{margin:0;color:#6C6C80;background-color:#F2F2FA;border:solid 1px #F2F2FA;border-style:solid none;padding:12px;}table th:first-of-type,table td:first-of-type{border-left-style:solid;border-top-left-radius:5px;border-bottom-left-radius:5px;}table th:last-child,table td:last-child{border-right-style:solid;border-bottom-right-radius:5px;border-top-right-radius:5px;}table tr th{color:#3D3D4D;text-align:left;font-weight:bold;}iframe{margin-bottom:16px;}img{max-width:100%;}ul,ol{color:#6C6C80;padding-left:15px;margin-bottom:16px;}ul li,ol li{line-height:28px;}li ul,li ol{margin-bottom:0;}.gatsby-highlight{font-family:Hack,SFMono-Regular,Menlo,Monaco,Consolas,'Liberation Mono','Courier New',monospace;font-variant:no-common-ligatures no-discretionary-ligatures no-historical-ligatures no-contextual;position:relative;z-index:0;margin:0 0 16px 0;overflow:auto;}.gatsby-highlight .token{font-style:normal!important;}pre[class*='language-'] code{font-family:inherit;}pre[class*='language-']::before{background:#d9d7e0;border-radius:0 0 4px 4px;color:#232129;font-size:12px;font-family:inherit;letter-spacing:0.075em;line-height:1;padding:0.25rem 0.5rem;position:absolute;left:1rem;text-align:right;text-transform:uppercase;top:0;}pre[class~='language-js']::before,pre[class~='language-javascript']::before{content:'js';background:#f7df1e;}pre[class~='language-jsx']::before{content:'jsx';background:#61dafb;}pre[class~='language-typescript']::before,pre[class~='language-ts']::before{content:'ts';background:#294e80;color:#fff;}pre[class~='language-tsx']::before{content:'tsx';background:#294e80;color:#fff;}pre[class~='language-graphql']::before{content:'GraphQL';background:#e10098;color:#fff;}pre[class~='language-html']::before{content:'html';background:#005a9c;color:#fff;}pre[class~='language-css']::before{content:'css';background:#ff9800;color:#fff;}pre[class~='language-mdx']::before{content:'mdx';background:#f9ac00;color:#fff;}pre[class~='language-shell']::before{content:'shell';}pre[class~='language-sh']::before{content:'sh';}pre[class~='language-bash']::before{content:'bash';}pre[class~='language-yaml']::before,pre[class~='language-yml']::before{content:'yaml';background:#ffa8df;}pre[class~='language-markdown']::before{content:'md';}pre[class~='language-json']::before,pre[class~='language-json5']::before{content:'json';background:linen;}pre[class~='language-diff']::before{content:'diff';background:#e6ffed;}pre[class~='language-text']::before{content:'text';background:#fff;}pre[class~='language-flow']::before{content:'flow';background:#e8bd36;}</style><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><style data-emotion="css d43d92">.css-d43d92::after{content:'';position:fixed;width:100%;height:100%;left:0;right:0;bottom:0;background-color:rgba(0, 0, 0, 0.8);z-index:999;display:none;}</style><div aria-label="Close menu" class="css-d43d92"></div><style data-emotion="css 1kjnnqm">.css-1kjnnqm{width:100%;max-width:1400px;margin:0 auto;padding:0 24px;display:grid;grid-template-columns:280px calc(100% - 320px);grid-auto-flow:row;grid-gap:40px;}@media (max-width: 780px){.css-1kjnnqm{padding:24px;grid-template-columns:100%;}}</style><div class="css-1kjnnqm eees1d52"><style data-emotion="css 9tjo13">.css-9tjo13{width:100%;overflow-y:auto;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;position:-webkit-sticky;position:sticky;top:0;padding-top:36px;-webkit-transition:-webkit-transform 0.5s;transition:transform 0.5s;height:calc(100vh - 1px);}.css-9tjo13 nav{width:100%;padding-top:24px;-webkit-align-self:flex-start;-ms-flex-item-align:flex-start;align-self:flex-start;-webkit-flex:1;-ms-flex:1;flex:1;}@media (max-width: 780px){.css-9tjo13{max-width:75%;min-width:auto;z-index:1001;position:fixed;top:0;bottom:0;left:0;padding-top:32px;background:#FFFFFF;-webkit-transform:translate3d(
      -100%,
      0,
      0
    );-moz-transform:translate3d(
      -100%,
      0,
      0
    );-ms-transform:translate3d(
      -100%,
      0,
      0
    );transform:translate3d(
      -100%,
      0,
      0
    );}}</style><aside class="css-9tjo13 e1wh78ri5"><style data-emotion="css 2yrou">.css-2yrou{width:100%;}.css-2yrou a{width:100%;padding-left:30px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:start;-ms-flex-pack:start;-webkit-justify-content:flex-start;justify-content:flex-start;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}</style><div class="css-2yrou e1wh78ri4"><a aria-label="Go to home page" href="/"><svg xmlns="http://www.w3.org/2000/svg" width="180" height="44" viewBox="0 0 1200 294" fill="none" aria-hidden="true"><g fill="#231F20"><path d="M271.1,90.2c9.8,0,17.7-7.9,17.7-17.7V22.8c0-9.8-7.9-17.7-17.7-17.7H22.7C12.9,5.1,5,13,5,22.8c0,0,0,0,0,0V147 c0,9.8,7.9,17.7,17.7,17.7c0,0,0,0,0,0h49.7c9.8,0,17.7-7.9,17.7-17.7c0-9.8-7.9-17.7-17.7-17.7H40.5V40.6h88.7v212.9H40.5v-31.9 c0-9.8-7.9-17.7-17.7-17.7S5,211.7,5,221.5l0,0v49.7c0,9.8,7.9,17.7,17.7,17.7h248.4c9.8,0,17.7-7.9,17.7-17.7V147 c0-9.8-7.9-17.7-17.7-17.7h-49.7c-9.8,0-17.7,7.9-17.7,17.7c0,9.8,7.9,17.7,17.7,17.7h31.9v88.7h-88.7V40.6h88.7v31.9 C253.4,82.3,261.3,90.2,271.1,90.2z"></path><path d="M399.9,56.8c6.2,0,11.3,5,11.3,11.3s-5,11.3-11.3,11.2c-6.2,0-11.3-5-11.3-11.3c0,0,0,0,0,0 C388.6,61.8,393.6,56.8,399.9,56.8C399.8,56.8,399.8,56.8,399.9,56.8z M408.2,211.5c0,4-0.2,5.6-1.5,7.6c-2.7,3.8-7.9,4.6-11.7,2 c-0.8-0.5-1.4-1.2-2-2c-1.3-2-1.5-3.6-1.5-7.6v-91.3c0-4,0.2-5.6,1.5-7.6c2.7-3.8,7.9-4.7,11.6-2c0.8,0.5,1.5,1.2,2,2 c1.3,2,1.5,3.6,1.5,7.6V211.5z"></path><path d="M494.3,123.3c-16.8,0-27.9,10.1-27.9,29.5v58.6c0,4-0.2,5.6-1.5,7.6c-2.7,3.8-7.9,4.6-11.7,2 c-0.8-0.5-1.4-1.2-2-2c-1.3-2-1.5-3.6-1.5-7.6v-91.3c0-4,0.2-5.6,1.5-7.6c2.7-3.8,7.9-4.7,11.6-2c0.8,0.5,1.5,1.2,2,2 c1.2,2,1.5,3.6,1.5,7.6v2c8-9.1,19.1-13.6,31.6-13.6c15.5,0,27.5,6.4,34.3,18.6c8.6-12.3,21.1-18.6,36.8-18.6 c12,0,22,3.9,28.8,10.4c8.1,7.7,12.3,18.2,12.3,31.1v61.3c0,4-0.2,5.6-1.5,7.6c-2.7,3.8-7.9,4.6-11.6,2c-0.8-0.5-1.4-1.2-2-2 c-1.3-2-1.5-3.6-1.5-7.6v-58.6c0-19.6-10.7-29.5-27.5-29.5c-16.3,0-27.8,10.1-27.8,27.7v60.4c0,4-0.2,5.6-1.5,7.6 c-2.7,3.8-7.9,4.6-11.7,2c-0.8-0.5-1.4-1.2-2-2c-1.2-2-1.5-3.6-1.5-7.6v-58.6C521.7,133.2,511.2,123.3,494.3,123.3z"></path><path d="M716.5,107.6c4,1.6,7.6,3.9,9.4,5.8c2.1,2.2,3.2,5.2,3.1,8.3c-0.2,3.4-1.5,6.6-3.9,9.1 c-2.1,2.3-5.1,3.6-8.3,3.5c-2.4,0-5.5-1-8.6-2.5c-7.2-3.3-14.5-5.9-22.9-5.9c-11.5,0-16.7,5.6-16.7,11.7c0,6.9,4.4,9.6,12.3,10.3 l18.5,1.8c23.4,2.1,35.3,14.5,35.3,34.6c0,26.1-22.3,38.6-50.1,38.6c-18.6,0-30.4-3.4-41-10.6c-4.1-2.7-7.2-6.6-7.2-11.4 c0-3.9,1.7-7.6,4.8-10.1c2.1-2,4.9-3,7.8-3c2.8,0,5.9,1.1,9.8,3.4c8.1,4.8,15.3,6.9,26.2,6.9s20.9-3.9,20.9-12.7 c0-5.8-3.2-10.1-12.5-11l-18.6-1.6c-21.3-2-34.8-11.6-34.8-33.4c0-24.6,21.7-37.6,45.9-37.6C698,102,707.5,103.9,716.5,107.6z"></path><path d="M856,215.5c-2.2,4.3-6.8,7-12.8,7s-10.7-2.7-12.8-7c-1.6-3.2-1.9-6-1.9-13.2v-52.3c0-16-10.2-21.4-19.5-21.4 s-19.8,5.3-19.8,21.4v52.3c0,7.1-0.3,10-1.9,13.2c-2.2,4.3-6.8,7-12.8,7s-10.7-2.7-12.8-7c-1.6-3.2-1.9-6-1.9-13.2V79.2 c0-7.2,0.3-10,1.9-13.2c2.2-4.3,6.8-7,12.8-7s10.7,2.7,12.8,7c1.6,3.2,1.9,6,1.9,13.2v35c7.5-7.7,16.1-12.3,28.8-12.3 c11.8,0,21.3,3.9,27.9,10.4c9.5,9.6,12,20.7,12,33.6v56.3C857.9,209.5,857.6,212.4,856,215.5z"></path><path d="M912.9,171.7c0,15.3,9,26.4,26.1,26.4c7.3,0.1,14.5-2.1,20.5-6.4c4.7-3.3,7.5-4.4,11-4.4 c5.7,0,11.9,5.6,11.9,12.4c0,5.6-4.8,10.7-11.6,15.2c-8.1,5.4-19.2,8.2-32.3,8.2c-28.1,0-54.8-12.7-54.8-60.6 c0-38.6,20.8-60.5,51.5-60.5c31.9,0,50.4,23,51.5,52.8c0.1,4.6-0.5,9.7-4,13.2c-3.8,3.7-8.5,3.7-13,3.7L912.9,171.7z M955.2,138.7 c-3.2-7-9.9-12.2-19.9-12.2s-16.7,5.1-19.8,12.2c-1.8,4-2.7,8.4-2.6,12.8h44.9C957.6,146.4,957.1,143,955.2,138.7L955.2,138.7z"></path><path d="M1019.4,129.4h-3c-5.6,0-7.6-0.3-10-1.6c-3.5-1.8-5.5-5.3-5.5-9.8s1.9-8,5.5-9.8c2.4-1.2,4.4-1.6,10-1.6h3 V90.9c0-7.2,0.3-10,1.9-13.2c2.2-4.3,6.8-7,12.8-7s10.7,2.7,12.8,7c1.6,3.2,1.9,6,1.9,13.2v15.8h8.8c5.6,0,7.6,0.3,10,1.6 c3.5,1.8,5.4,5.3,5.4,9.8s-1.9,7.9-5.4,9.8c-2.4,1.3-4.4,1.6-10,1.6h-8.8v56.8c0,5.6,2,10,9.5,10.4c3.7,0.2,6.3,0.6,8.9,1.8 c3.6,1.8,5.9,5.2,5.9,10.6s-2.4,8.7-5.9,10.6c-2.6,1.4-6.5,2-12.2,2h-1.6c-24.5,0-34.2-16.6-34.2-33.8L1019.4,129.4z"></path><path d="M1193.1,215.5c-2.2,4.3-6.8,7-12.8,7s-10.7-2.7-12.8-7c-1.6-3.2-1.9-6-1.9-13.2v-52.3 c0-16-10.2-21.4-19.5-21.4s-19.8,5.3-19.8,21.4v52.3c0,7.1-0.3,10-1.9,13.2c-2.2,4.3-6.8,7-12.8,7s-10.7-2.7-12.8-7 c-1.6-3.2-1.9-6-1.9-13.2V79.2c0-7.2,0.3-10,1.9-13.2c2.2-4.3,6.8-7,12.8-7s10.7,2.7,12.8,7c1.6,3.2,1.9,6,1.9,13.2v35 c7.5-7.7,16.1-12.3,28.8-12.3c11.8,0,21.3,3.9,27.9,10.4c9.6,9.6,12,20.7,12,33.6v56.3C1195,209.5,1194.7,212.4,1193.1,215.5z"></path></g></svg></a></div><nav><style data-emotion="css qmhqz9">.css-qmhqz9{list-style:none;width:100%;padding-left:0;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:start;-ms-flex-pack:start;-webkit-justify-content:flex-start;justify-content:flex-start;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}</style><ul class="css-qmhqz9 e1wh78ri3"><style data-emotion="css why3vc">.css-why3vc{font-size:15px;width:100%;-webkit-transition:all 200ms ease-in-out;transition:all 200ms ease-in-out;padding:0 20px;cursor:pointer;}.css-why3vc a,.css-why3vc span{display:block;font-size:15px;color:#6C6C80;background-color:#FFFFFF;padding:4px 10px;margin:4px 0;border-radius:4px;font-weight:normal;-webkit-text-decoration:none;text-decoration:none;width:100%;height:100%;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:start;-ms-flex-pack:start;-webkit-justify-content:flex-start;justify-content:flex-start;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;cursor:pointer;margin:0 auto;-webkit-transition:all 0.2s ease;transition:all 0.2s ease;}.css-why3vc a svg,.css-why3vc span svg{width:20px;height:20px;margin-right:10px;}.css-why3vc a:not(.active-link):hover,.css-why3vc span:not(.active-link):hover{color:#8257E6;}.css-why3vc a.active-link,.css-why3vc span.active-link{color:#8257E6;background-color:#F2F2FA;}@media (max-width: 780px){.css-why3vc a.active-link,.css-why3vc span.active-link{background:#F2F2FA;}}</style><li class="css-why3vc e1wh78ri1"><a href="/">Meta</a></li><style data-emotion="css mximbs">.css-mximbs{padding-left:30px;width:100%;text-transform:uppercase;font-size:14px;font-weight:bold;margin-top:20px;color:#3D3D4D;letter-spacing:0.142em;}</style><li class="css-mximbs e1wh78ri2">Posts</li><style data-emotion="css 1cgn8l4">.css-1cgn8l4{list-style:none;width:100%;padding-left:0;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:start;-ms-flex-pack:start;-webkit-justify-content:flex-start;justify-content:flex-start;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;margin:5px 0 0 0;}</style><ul class="css-1cgn8l4 e1wh78ri0"><li class="css-why3vc e1wh78ri1"><a href="/posts/tags/tech">Tech</a></li><li class="css-why3vc e1wh78ri1"><a href="/posts/tags/travel">Travel</a></li><li class="css-why3vc e1wh78ri1"><a href="/posts/tags/food">Food</a></li><li class="css-why3vc e1wh78ri1"><a href="/posts/tags/etc">Etc</a></li></ul><li class="css-mximbs e1wh78ri2">Talks</li><ul class="css-1cgn8l4 e1wh78ri0"><li class="css-why3vc e1wh78ri1"><a href="/talks/tags/tech">Tech</a></li></ul><li class="css-mximbs e1wh78ri2">Misc</li><ul class="css-1cgn8l4 e1wh78ri0"><li class="css-why3vc e1wh78ri1"><a href="/misc/tags/gratitude">Gratitude</a></li></ul></ul></nav></aside><style data-emotion="css u8hwp7">.css-u8hwp7{height:100%;padding-top:36px;width:100%;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:start;-ms-flex-pack:start;-webkit-justify-content:flex-start;justify-content:flex-start;position:relative;}@media (max-width: 1200px){.css-u8hwp7{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}}@media (max-width: 780px){.css-u8hwp7{padding-top:0;}}</style><main class="css-u8hwp7 eees1d51"><style data-emotion="css 1p24zom">.css-1p24zom{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:start;-ms-flex-pack:start;-webkit-justify-content:flex-start;justify-content:flex-start;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;height:40px;margin-bottom:24px;}.css-1p24zom h2{margin:0;border:none;padding:0;font-size:18px;}@media (max-width: 359px){.css-1p24zom h2{font-size:14px;}}.css-1p24zom button{border:none;background:none;cursor:pointer;margin-right:16px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:start;-ms-flex-pack:start;-webkit-justify-content:flex-start;justify-content:flex-start;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}@media (min-width: 780px){.css-1p24zom{display:none;}}</style><header class="css-1p24zom esnpb7p0"><button aria-label="Open sidebar" type="button"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" aria-hidden="true" height="23" width="23" xmlns="http://www.w3.org/2000/svg"><path d="M32 96v64h448V96H32zm0 128v64h448v-64H32zm0 128v64h448v-64H32z"></path></svg></button><h2>Ishan Sheth (imsheth)</h2></header><style data-emotion="css 1j7nlw4">.css-1j7nlw4{display:none;}@media (max-width: 1200px){.css-1j7nlw4{display:block;}}</style><h1 class="css-1j7nlw4">The Hows - Apache Airflow 2 using DockerOperator with node.js and Gitlab container registry on Ubuntu 20</h1><style data-emotion="css 1h97cat">.css-1h97cat{width:100%;max-width:calc(75% - 64px);padding-right:64px;}@media (max-width: 1200px){.css-1h97cat{max-width:100%;padding-right:0;-webkit-order:3;-ms-flex-order:3;order:3;}}.css-1h97cat h1,.css-1h97cat h2,.css-1h97cat h3,.css-1h97cat h4,.css-1h97cat h5,.css-1h97cat h6{overflow-wrap:break-word;}</style><div class="css-1h97cat eees1d50"><style data-emotion="css 1fdmakl">@media (max-width: 1200px){.css-1fdmakl{display:none;}}</style><h1 class="css-1fdmakl">The Hows - Apache Airflow 2 using DockerOperator with node.js and Gitlab container registry on Ubuntu 20</h1><p><code class="inline-code">Jul 25, 2021</code></p><blockquote><p style="text-align:center">The motivation for writing this post is in the hope that it helps others save lots of time, energy and nerve wracking phases that can lead to self doubt which I had extensively faced and would want others to avoid them altogether.</p></blockquote><p>This post is focused on how to setup Apache Airflow 2 using DockerOperator with node.js and Gitlab container registry on Ubuntu 20</p><a href="https://github.com/imsheth/airflow2-dockeroperator-nodejs-gitlab" target="_blank" rel="noopener noreferrer">The relevant source code for the post can be found here</a><br/><br/><hr/><h2 id="ubuntu-20xx" style="position:relative"><a href="#ubuntu-20xx" aria-label="ubuntu 20xx permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Ubuntu 20.x.x</h2><ol><li>Check the machine operating system, it should be Ubuntu 20.x.x to have the best shot at successful installation on the first attempt</li><li>Our test machine operating system details (Ubuntu 20.04.2 LTS (Focal Fossa))</li></ol><div class="gatsby-highlight"><style data-emotion="css 1wertj5">.css-1wertj5{text-align:left;padding:2rem 1rem 1rem 1rem;overflow:auto;white-space:pre;word-spacing:normal;word-break:normal;border-radius:5px;-webkit-overflow-scrolling:touch;overflow-wrap:break-word;box-shadow:1px 1px 20px rgba(20, 20, 20, 0.27);}.css-1wertj5 code{float:left;min-width:100%;padding-right:1rem;}.css-1wertj5 .token-line{line-height:22px;font-size:14px;min-width:100%;}.css-1wertj5 .highlight-line{background-color:#44475a;margin-left:-1rem;margin-right:-2rem;padding:0 0.75rem;border-left:4px solid #8257E6;}</style><pre class="prism-code language-shell css-1wertj5 eiqe2b57" style="color:#F8F8F2;background-color:#282A36"><style data-emotion="css 1r5hp7i">.css-1r5hp7i{position:absolute;top:0;right:0;z-index:1;border-radius:0 5px 0 5px;padding:0.25rem 0.6rem;border:none;cursor:pointer;background:#44475a;color:rgb(248, 248, 242);-webkit-transition:all 200ms ease;transition:all 200ms ease;font-size:12px;}.css-1r5hp7i:disabled{cursor:not-allowed;}.css-1r5hp7i:not(:disabled):hover,.css-1r5hp7i:not(:disabled):focus{background:#8257E6;}</style><button class="css-1r5hp7i eiqe2b50">Copy</button><code><div class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">cat</span><span class="token plain"> /etc/os-release</span></div></code></pre></div><a href="/posts/airflow2-dockeroperator-nodejs-gitlab/1.png" target="_blank" rel="noopener noreferrer"><img src="/posts/airflow2-dockeroperator-nodejs-gitlab/1.png" alt="airflow2-dockeroperator-nodejs-gitlab-1-png" align="left" style="margin-right:2rem;margin-bottom:1rem"/></a><ol start="3"><li><p>It is recommended to use the LTS version but not necessary</p></li><li><p>This completes Ubuntu check</p></li></ol><hr/><h2 id="python-36" style="position:relative"><a href="#python-36" aria-label="python 36 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>python 3.6</h2><ul><li><a href="https://github.com/apache/airflow#requirements" target="_blank" rel="noopener noreferrer">Airflow works with specific versions of python, install python 3.6 as other versions aren&#x27;t supported by airflow for DockerOperator though the documentation states otherwise</a></li><li><a href="https://www.makeuseof.com/install-python-ubuntu/" target="_blank" rel="noopener noreferrer">python ppa installation</a></li></ul><ol><li>Install python 3.6 and required packages</li></ol><div class="gatsby-highlight"><pre class="prism-code language-shell css-1wertj5 eiqe2b57" style="color:#F8F8F2;background-color:#282A36"><button class="css-1r5hp7i eiqe2b50">Copy</button><code><div class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> add-apt-repository ppa:deadsnakes/ppa </span><span class="token operator">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">apt-get</span><span class="token plain"> update </span><span class="token operator">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">apt-get</span><span class="token plain"> -y upgrade </span><span class="token operator">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">apt-get</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">install</span><span class="token plain"> software-properties-common </span><span class="token operator">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">apt</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">install</span><span class="token plain"> build-essential zlib1g-dev libncurses5-dev libgdbm-dev libnss3-dev libssl-dev libreadline-dev libffi-dev </span><span class="token function" style="color:rgb(80, 250, 123)">wget</span><span class="token plain"> </span><span class="token operator">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">apt</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">install</span><span class="token plain"> python3.6 </span><span class="token operator">&amp;&amp;</span><span class="token plain"> python3.6 --version</span></div></code></pre></div><a href="/posts/airflow2-dockeroperator-nodejs-gitlab/2.png" target="_blank" rel="noopener noreferrer"><img src="/posts/airflow2-dockeroperator-nodejs-gitlab/2.png" alt="airflow2-dockeroperator-nodejs-gitlab-2-png" align="left" style="margin-right:2rem;margin-bottom:1rem"/></a><a href="/posts/airflow2-dockeroperator-nodejs-gitlab/3.png" target="_blank" rel="noopener noreferrer"><img src="/posts/airflow2-dockeroperator-nodejs-gitlab/3.png" alt="airflow2-dockeroperator-nodejs-gitlab-3-png" align="left" style="margin-right:2rem;margin-bottom:1rem"/></a><ol start="2"><li>Verify python 3.6 installation path</li></ol><div class="gatsby-highlight"><pre class="prism-code language-shell css-1wertj5 eiqe2b57" style="color:#F8F8F2;background-color:#282A36"><button class="css-1r5hp7i eiqe2b50">Copy</button><code><div class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">whereis</span><span class="token plain"> python</span></div></code></pre></div><a href="/posts/airflow2-dockeroperator-nodejs-gitlab/4.png" target="_blank" rel="noopener noreferrer"><img src="/posts/airflow2-dockeroperator-nodejs-gitlab/4.png" alt="airflow2-dockeroperator-nodejs-gitlab-4-png" align="left" style="margin-right:2rem;margin-bottom:1rem"/></a><ol start="3"><li>Set environment/path/alias variables for python 3.6 &amp; pip 20.2.4</li></ol><ul><li><a href="https://stackoverflow.com/a/60083786/3152654" target="_blank" rel="noopener noreferrer">Setting path variable for python 3.6</a></li><li><a href="https://stackoverflow.com/a/41986556/3152654" target="_blank" rel="noopener noreferrer">Set alias for python to point to python 3.6</a></li><li><a href="https://askubuntu.com/a/956193" target="_blank" rel="noopener noreferrer">Set alias for python to point to python 3.6 in .bashrc</a></li></ul><div class="gatsby-highlight"><pre class="prism-code language-shell css-1wertj5 eiqe2b57" style="color:#F8F8F2;background-color:#282A36"><button class="css-1r5hp7i eiqe2b50">Copy</button><code><div class="token-line" style="color:#F8F8F2"><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;export PATH=</span><span class="token string environment constant" style="color:rgb(189, 147, 249)">$PATH</span><span class="token string" style="color:rgb(255, 121, 198)">:&quot;/usr/bin/python3.6&quot;&#x27;</span><span class="token plain"> </span><span class="token operator">&gt;&gt;</span><span class="token plain"> ~/.bashrc </span><span class="token operator">&amp;&amp;</span><span class="token plain"> </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;alias python=&quot;python3.6&quot;&#x27;</span><span class="token plain"> </span><span class="token operator">&gt;&gt;</span><span class="token plain"> ~/.bashrc </span><span class="token operator">&amp;&amp;</span><span class="token plain"> </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;export PATH=</span><span class="token string environment constant" style="color:rgb(189, 147, 249)">$PATH</span><span class="token string" style="color:rgb(255, 121, 198)">:&quot;/home/ubuntu/.local/bin&quot;&#x27;</span><span class="token plain"> </span><span class="token operator">&gt;&gt;</span><span class="token plain"> ~/.bashrc </span><span class="token operator">&amp;&amp;</span><span class="token plain"> </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;alias pip=&quot;pip3&quot;&#x27;</span><span class="token plain"> </span><span class="token operator">&gt;&gt;</span><span class="token plain"> ~/.bashrc </span><span class="token operator">&amp;&amp;</span><span class="token plain"> </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">source</span><span class="token plain"> ~/.bashrc </span><span class="token operator">&amp;&amp;</span><span class="token plain"> </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token environment constant" style="color:rgb(189, 147, 249)">$PATH</span><span class="token plain"> </span><span class="token operator">&amp;&amp;</span><span class="token plain"> python --version</span></div></code></pre></div><a href="/posts/airflow2-dockeroperator-nodejs-gitlab/5.png" target="_blank" rel="noopener noreferrer"><img src="/posts/airflow2-dockeroperator-nodejs-gitlab/5.png" alt="airflow2-dockeroperator-nodejs-gitlab-5-png" align="left" style="margin-right:2rem;margin-bottom:1rem"/></a><ol start="4"><li>pip 20.2.4</li></ol><ul><li><a href="https://pip.pypa.io/en/stable/installing/" target="_blank" rel="noopener noreferrer">pip installation</a></li><li><a href="https://airflow.apache.org/docs/apache-airflow/stable/start/local.html" target="_blank" rel="noopener noreferrer">Only pip installation is currently officially supported by Apache Airflow 2</a></li></ul><div class="gatsby-highlight"><pre class="prism-code language-shell css-1wertj5 eiqe2b57" style="color:#F8F8F2;background-color:#282A36"><button class="css-1r5hp7i eiqe2b50">Copy</button><code><div class="token-line" style="color:#F8F8F2"><span class="token builtin class-name" style="color:rgb(189, 147, 249)">cd</span><span class="token plain"> /tmp </span><span class="token operator">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">curl</span><span class="token plain"> https://bootstrap.pypa.io/get-pip.py -o get-pip.py </span><span class="token operator">&amp;&amp;</span><span class="token plain"> python get-pip.py </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">pip</span><span class="token operator">==</span><span class="token number">20.2</span><span class="token plain">.4 </span><span class="token operator">&amp;&amp;</span><span class="token plain"> pip --version</span></div></code></pre></div><a href="/posts/airflow2-dockeroperator-nodejs-gitlab/6.png" target="_blank" rel="noopener noreferrer"><img src="/posts/airflow2-dockeroperator-nodejs-gitlab/6.png" alt="airflow2-dockeroperator-nodejs-gitlab-6-png" align="left" style="margin-right:2rem;margin-bottom:1rem"/></a><ol start="5"><li><a href="https://airflow.apache.org/docs/apache-airflow/2.0.0/installation.html" target="_blank" rel="noopener noreferrer">On November 2020, new version of PIP (20.3) has been released with a new, 2020 resolver. This resolver might work with Apache Airflow as of 20.3.3, but it might lead to errors in installation. It might depend on your choice of extras. In order to install Airflow you might need to either downgrade pip to version 20.2.4 pip install --upgrade pip==20.2.4 or, in case you use Pip 20.3, you need to add option --use-deprecated legacy-resolver to your pip install command.</a></li><li><p>This completes python and pip installation</p></li></ol><hr/><h2 id="airflow-201" style="position:relative"><a href="#airflow-201" aria-label="airflow 201 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Airflow 2.0.1</h2><ul><li><a href="https://airflow.apache.org/docs/apache-airflow/stable/start/local.html" target="_blank" rel="noopener noreferrer">airflow needs a home, ~/airflow is the default, but you can lay foundation somewhere else if you prefer (optional)</a></li></ul><ol><li>Create directories and set environment variables</li></ol><div class="gatsby-highlight"><pre class="prism-code language-shell css-1wertj5 eiqe2b57" style="color:#F8F8F2;background-color:#282A36"><button class="css-1r5hp7i eiqe2b50">Copy</button><code><div class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">mkdir</span><span class="token plain"> airflow </span><span class="token operator">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">mkdir</span><span class="token plain"> dags_root </span><span class="token operator">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">mkdir</span><span class="token plain"> logs_root  </span><span class="token operator">&amp;&amp;</span><span class="token plain"> </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;export AIRFLOW_HOME=&quot;/home/ubuntu/airflow&quot;&#x27;</span><span class="token plain"> </span><span class="token operator">&gt;&gt;</span><span class="token plain"> ~/.bashrc </span><span class="token operator">&amp;&amp;</span><span class="token plain"> </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;export AIRFLOW_VERSION=&quot;2.0.1&quot;&#x27;</span><span class="token plain"> </span><span class="token operator">&gt;&gt;</span><span class="token plain"> ~/.bashrc </span><span class="token operator">&amp;&amp;</span><span class="token plain"> </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;export PYTHON_VERSION=&quot;</span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">$(</span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">python --version </span><span class="token string variable operator" style="color:rgb(189, 147, 249);font-style:italic">|</span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic"> </span><span class="token string variable function" style="color:rgb(80, 250, 123);font-style:italic">cut</span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic"> -d </span><span class="token string variable string" style="color:rgb(255, 121, 198);font-style:italic">&quot; &quot;</span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic"> -f </span><span class="token string variable number" style="color:rgb(189, 147, 249);font-style:italic">2</span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic"> </span><span class="token string variable operator" style="color:rgb(189, 147, 249);font-style:italic">|</span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic"> </span><span class="token string variable function" style="color:rgb(80, 250, 123);font-style:italic">cut</span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic"> -d </span><span class="token string variable string" style="color:rgb(255, 121, 198);font-style:italic">&quot;.&quot;</span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic"> -f </span><span class="token string variable number" style="color:rgb(189, 147, 249);font-style:italic">1</span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">-2</span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">)</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;&#x27;</span><span class="token plain"> </span><span class="token operator">&gt;&gt;</span><span class="token plain"> ~/.bashrc </span><span class="token operator">&amp;&amp;</span><span class="token plain"> </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;export CONSTRAINT_URL=&quot;https://raw.githubusercontent.com/apache/airflow/constraints-</span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">${AIRFLOW_VERSION}</span><span class="token string" style="color:rgb(255, 121, 198)">/constraints-</span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">${PYTHON_VERSION}</span><span class="token string" style="color:rgb(255, 121, 198)">.txt&quot;&#x27;</span><span class="token plain"> </span><span class="token operator">&gt;&gt;</span><span class="token plain"> ~/.bashrc </span><span class="token operator">&amp;&amp;</span><span class="token plain"> </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">source</span><span class="token plain"> ~/.bashrc</span></div></code></pre></div><a href="/posts/airflow2-dockeroperator-nodejs-gitlab/7.png" target="_blank" rel="noopener noreferrer"><img src="/posts/airflow2-dockeroperator-nodejs-gitlab/7.png" alt="airflow2-dockeroperator-nodejs-gitlab-7-png" align="left" style="margin-right:2rem;margin-bottom:1rem"/></a><ol start="2"><li>Create virtual environment, the installation causes issues with gunicorn if not using one</li></ol><div class="gatsby-highlight"><pre class="prism-code language-shell css-1wertj5 eiqe2b57" style="color:#F8F8F2;background-color:#282A36"><button class="css-1r5hp7i eiqe2b50">Copy</button><code><div class="token-line" style="color:#F8F8F2"><span class="token builtin class-name" style="color:rgb(189, 147, 249)">cd</span><span class="token plain"> airflow </span><span class="token operator">&amp;&amp;</span><span class="token plain"> pip </span><span class="token function" style="color:rgb(80, 250, 123)">install</span><span class="token plain"> virtualenv </span><span class="token operator">&amp;&amp;</span><span class="token plain"> virtualenv -p python3.6 airflow_venv </span><span class="token operator">&amp;&amp;</span><span class="token plain"> </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">source</span><span class="token plain"> airflow_venv/bin/activate</span></div></code></pre></div><a href="/posts/airflow2-dockeroperator-nodejs-gitlab/8.png" target="_blank" rel="noopener noreferrer"><img src="/posts/airflow2-dockeroperator-nodejs-gitlab/8.png" alt="airflow2-dockeroperator-nodejs-gitlab-8-png" align="left" style="margin-right:2rem;margin-bottom:1rem"/></a><ol start="3"><li>Install Apache Airflow 2.0.1</li></ol><div class="gatsby-highlight"><pre class="prism-code language-shell css-1wertj5 eiqe2b57" style="color:#F8F8F2;background-color:#282A36"><button class="css-1r5hp7i eiqe2b50">Copy</button><code><div class="token-line" style="color:#F8F8F2"><span class="token plain">pip </span><span class="token function" style="color:rgb(80, 250, 123)">install</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;apache-airflow==</span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">${AIRFLOW_VERSION}</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;</span><span class="token plain"> --constraint </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;</span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">${CONSTRAINT_URL}</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;</span></div></code></pre></div><a href="/posts/airflow2-dockeroperator-nodejs-gitlab/9.png" target="_blank" rel="noopener noreferrer"><img src="/posts/airflow2-dockeroperator-nodejs-gitlab/9.png" alt="airflow2-dockeroperator-nodejs-gitlab-9-png" align="left" style="margin-right:2rem;margin-bottom:1rem"/></a><ol start="4"><li>This completes Apache Airflow 2 installation</li></ol><hr/><h2 id="postgres-12" style="position:relative"><a href="#postgres-12" aria-label="postgres 12 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Postgres 12</h2><ul><li><a href="https://www.digitalocean.com/community/tutorials/how-to-install-postgresql-on-ubuntu-20-04-quickstart" target="_blank" rel="noopener noreferrer">Postgres installation</a></li></ul><ol><li>Install Postgres 12</li></ol><div class="gatsby-highlight"><pre class="prism-code language-shell css-1wertj5 eiqe2b57" style="color:#F8F8F2;background-color:#282A36"><button class="css-1r5hp7i eiqe2b50">Copy</button><code><div class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">apt</span><span class="token plain"> update </span><span class="token operator">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">apt</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">install</span><span class="token plain"> postgresql postgresql-contrib</span></div></code></pre></div><a href="/posts/airflow2-dockeroperator-nodejs-gitlab/10.png" target="_blank" rel="noopener noreferrer"><img src="/posts/airflow2-dockeroperator-nodejs-gitlab/10.png" alt="airflow2-dockeroperator-nodejs-gitlab-10-png" align="left" style="margin-right:2rem;margin-bottom:1rem"/></a><ol start="2"><li><p>Your data directory would be <code class="inline-code">/var/lib/postgresql/12/main</code> and log file would be <code class="inline-code">/var/log/postgresql/postgresql-12-main.log</code></p></li><li><p>Setup Postgres</p></li></ol><div class="gatsby-highlight"><pre class="prism-code language-shell css-1wertj5 eiqe2b57" style="color:#F8F8F2;background-color:#282A36"><button class="css-1r5hp7i eiqe2b50">Copy</button><code><div class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> -i -u postgres</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">createdb airflow</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">createuser --interactive</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">## Enter name of role to add: </span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">airflow</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">## Shall the new role be a superuser? (y/n)</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">y</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">exit</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">## Add airflow user</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> adduser airflow</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> -u airflow psql</span></div></code></pre></div><ol start="4"><li><a href="https://chartio.com/resources/tutorials/how-to-list-databases-and-tables-in-postgresql-using-psql/" target="_blank" rel="noopener noreferrer">List databases and tables to verify</a></li></ol><div class="gatsby-highlight"><pre class="prism-code language-shell css-1wertj5 eiqe2b57" style="color:#F8F8F2;background-color:#282A36"><button class="css-1r5hp7i eiqe2b50">Copy</button><code><div class="token-line" style="color:#F8F8F2"><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain">l</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain">c airflow</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain">dt</span></div></code></pre></div><a href="/posts/airflow2-dockeroperator-nodejs-gitlab/11.png" target="_blank" rel="noopener noreferrer"><img src="/posts/airflow2-dockeroperator-nodejs-gitlab/11.png" alt="airflow2-dockeroperator-nodejs-gitlab-11-png" align="left" style="margin-right:2rem;margin-bottom:1rem"/></a><ol start="5"><li><a href="https://airflow.apache.org/docs/apache-airflow/stable/howto/set-up-database.html" target="_blank" rel="noopener noreferrer">Setup users</a></li></ol><div class="gatsby-highlight"><pre class="prism-code language-shell css-1wertj5 eiqe2b57" style="color:#F8F8F2;background-color:#282A36"><button class="css-1r5hp7i eiqe2b50">Copy</button><code><div class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> -i -u postgres</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">psql</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">CREATE </span><span class="token environment constant" style="color:rgb(189, 147, 249)">USER</span><span class="token plain"> airflow_user WITH PASSWORD </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;airflow_user&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">GRANT ALL PRIVILEGES ON DATABASE airflow TO airflow_user</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">exit</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">exit</span></div></code></pre></div><a href="/posts/airflow2-dockeroperator-nodejs-gitlab/12.png" target="_blank" rel="noopener noreferrer"><img src="/posts/airflow2-dockeroperator-nodejs-gitlab/12.png" alt="airflow2-dockeroperator-nodejs-gitlab-12-png" align="left" style="margin-right:2rem;margin-bottom:1rem"/></a><ol start="6"><li>This completes Postgres installation and setup</li></ol><hr/><h2 id="airflow-201-config" style="position:relative"><a href="#airflow-201-config" aria-label="airflow 201 config permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Airflow 2.0.1 config</h2><ol><li>Change the config as per requirement</li></ol><ul><li>Defaults are available at <a href="https://airflow.apache.org/docs/apache-airflow/stable/configurations-ref.html">https://airflow.apache.org/docs/apache-airflow/stable/configurations-ref.html</a></li></ul><div class="gatsby-highlight"><pre class="prism-code language-shell css-1wertj5 eiqe2b57" style="color:#F8F8F2;background-color:#282A36"><button class="css-1r5hp7i eiqe2b50">Copy</button><code><div class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">vim</span><span class="token plain"> /home/ubuntu/airflow/airflow.cfg</span></div></code></pre></div><blockquote><p>Recommended for optimum usage</p></blockquote><blockquote><a href="https://airflow.apache.org/docs/apache-airflow/stable/configurations-ref.html#dags-folder" target="_blank" rel="noopener noreferrer">dags_folder = /home/ubuntu/dags_root</a></blockquote><blockquote><a href="https://airflow.apache.org/docs/apache-airflow/stable/executor/local.html" target="_blank" rel="noopener noreferrer">executor = LocalExecutor</a></blockquote><blockquote><a href="https://airflow.apache.org/docs/apache-airflow/stable/configurations-ref.html#sql-alchemy-conn" target="_blank" rel="noopener noreferrer">sql_alchemy_conn = postgresql+psycopg2://airflow_user:airflow_user@localhost:5432/airflow</a></blockquote><blockquote><a href="https://airflow.apache.org/docs/apache-airflow/stable/configurations-ref.html#base-log-folder" target="_blank" rel="noopener noreferrer">base_log_folder = /home/ubuntu/logs_root</a></blockquote><blockquote><a href="https://airflow.apache.org/docs/apache-airflow/stable/configurations-ref.html#logging-level" target="_blank" rel="noopener noreferrer">logging_level = DEBUG</a></blockquote><blockquote><a href="https://airflow.apache.org/docs/apache-airflow/stable/security/api.html#disable-authentication" target="_blank" rel="noopener noreferrer">auth_backend = airflow.api.auth.backend.default</a></blockquote><blockquote><a href="https://github.com/apache/airflow/issues/13487#issuecomment-757661848" target="_blank" rel="noopener noreferrer">enable_xcom_pickling = True</a></blockquote><blockquote><a href="https://stackoverflow.com/a/65380493/3152654" target="_blank" rel="noopener noreferrer">job_heartbeat_sec = 120</a></blockquote><blockquote><a href="https://stackoverflow.com/a/47562663/3152654" target="_blank" rel="noopener noreferrer">min_file_process_interval = 120</a></blockquote><blockquote><a href="https://big-data-demystified.ninja/2020/03/23/airflow-performance-tuning-in-5-min/" target="_blank" rel="noopener noreferrer">scheduler_zombie_task_threshold = 1800</a></blockquote><blockquote><p>Optional but useful</p></blockquote><blockquote><a href="https://airflow.apache.org/docs/apache-airflow/stable/configurations-ref.html#expose-config" target="_blank" rel="noopener noreferrer">expose_config = True</a></blockquote><blockquote><a href="https://airflow.apache.org/docs/apache-airflow/stable/configurations-ref.html#base-url" target="_blank" rel="noopener noreferrer">base_url = http://continental.thehightable.org:8080</a></blockquote><blockquote><a href="https://airflow.apache.org/docs/apache-airflow/stable/configurations-ref.html#hostname-callable" target="_blank" rel="noopener noreferrer">hostname_callable = socket:gethostname</a></blockquote><blockquote><a href="https://airflow.apache.org/docs/apache-airflow/stable/configurations-ref.html#worker-autoscale" target="_blank" rel="noopener noreferrer">worker_autoscale = 16,12</a></blockquote><blockquote><a href="https://airflow.apache.org/docs/apache-airflow/stable/configurations-ref.html#broker-url" target="_blank" rel="noopener noreferrer">broker_url = amqp://guest:guest@localhost:5672//</a></blockquote><blockquote><a href="https://airflow.apache.org/docs/apache-airflow/stable/configurations-ref.html#result-backend" target="_blank" rel="noopener noreferrer">celery_result_backend = amqp://guest:guest@localhost:5672//</a></blockquote><ol start="2"><li>Boot up webserver</li></ol><div class="gatsby-highlight"><pre class="prism-code language-shell css-1wertj5 eiqe2b57" style="color:#F8F8F2;background-color:#282A36"><button class="css-1r5hp7i eiqe2b50">Copy</button><code><div class="token-line" style="color:#F8F8F2"><span class="token plain">airflow webserver</span></div></code></pre></div><a href="/posts/airflow2-dockeroperator-nodejs-gitlab/13.png" target="_blank" rel="noopener noreferrer"><img src="/posts/airflow2-dockeroperator-nodejs-gitlab/13.png" alt="airflow2-dockeroperator-nodejs-gitlab-13-png" align="left" style="margin-right:2rem;margin-bottom:1rem"/></a><ol start="3"><li><a href="https://stackoverflow.com/a/65079921/3152654" target="_blank" rel="noopener noreferrer">Fix ## ImportError: No module named psycopg2</a></li></ol><div class="gatsby-highlight"><pre class="prism-code language-shell css-1wertj5 eiqe2b57" style="color:#F8F8F2;background-color:#282A36"><button class="css-1r5hp7i eiqe2b50">Copy</button><code><div class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">apt-get</span><span class="token plain"> update </span><span class="token operator">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">apt-get</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">install</span><span class="token plain"> libpq-dev </span><span class="token operator">&amp;&amp;</span><span class="token plain"> pip3 </span><span class="token function" style="color:rgb(80, 250, 123)">install</span><span class="token plain"> psycopg2-binary</span></div></code></pre></div><a href="/posts/airflow2-dockeroperator-nodejs-gitlab/14.png" target="_blank" rel="noopener noreferrer"><img src="/posts/airflow2-dockeroperator-nodejs-gitlab/14.png" alt="airflow2-dockeroperator-nodejs-gitlab-14-png" align="left" style="margin-right:2rem;margin-bottom:1rem"/></a><ol start="4"><li>Initialize the database (This has to be done only once you set your config else it&#x27;ll take the settings from config before you edited the config)</li></ol><div class="gatsby-highlight"><pre class="prism-code language-shell css-1wertj5 eiqe2b57" style="color:#F8F8F2;background-color:#282A36"><button class="css-1r5hp7i eiqe2b50">Copy</button><code><div class="token-line" style="color:#F8F8F2"><span class="token plain">airflow db init</span></div></code></pre></div><a href="/posts/airflow2-dockeroperator-nodejs-gitlab/15.png" target="_blank" rel="noopener noreferrer"><img src="/posts/airflow2-dockeroperator-nodejs-gitlab/15.png" alt="airflow2-dockeroperator-nodejs-gitlab-15-png" align="left" style="margin-right:2rem;margin-bottom:1rem"/></a><ol start="5"><li>Create airflow user</li></ol><div class="gatsby-highlight"><pre class="prism-code language-shell css-1wertj5 eiqe2b57" style="color:#F8F8F2;background-color:#282A36"><button class="css-1r5hp7i eiqe2b50">Copy</button><code><div class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">## username john</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">## password wick</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">airflow </span><span class="token function" style="color:rgb(80, 250, 123)">users</span><span class="token plain"> create </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    --username john </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    --firstname John </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    --lastname Wick </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    --role Admin </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    --email john@thehightable.org</span></div></code></pre></div><a href="/posts/airflow2-dockeroperator-nodejs-gitlab/16.png" target="_blank" rel="noopener noreferrer"><img src="/posts/airflow2-dockeroperator-nodejs-gitlab/16.png" alt="airflow2-dockeroperator-nodejs-gitlab-16-png" align="left" style="margin-right:2rem;margin-bottom:1rem"/></a><ol start="6"><li>Boot up the scheduler (from a new ssh session)</li></ol><div class="gatsby-highlight"><pre class="prism-code language-shell css-1wertj5 eiqe2b57" style="color:#F8F8F2;background-color:#282A36"><button class="css-1r5hp7i eiqe2b50">Copy</button><code><div class="token-line" style="color:#F8F8F2"><span class="token builtin class-name" style="color:rgb(189, 147, 249)">cd</span><span class="token plain"> airflow </span><span class="token operator">&amp;&amp;</span><span class="token plain"> </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">source</span><span class="token plain"> airflow_venv/bin/activate </span><span class="token operator">&amp;&amp;</span><span class="token plain"> airflow scheduler</span></div></code></pre></div><a href="/posts/airflow2-dockeroperator-nodejs-gitlab/17.png" target="_blank" rel="noopener noreferrer"><img src="/posts/airflow2-dockeroperator-nodejs-gitlab/17.png" alt="airflow2-dockeroperator-nodejs-gitlab-17-png" align="left" style="margin-right:2rem;margin-bottom:1rem"/></a><ol start="7"><li>Boot up the webserver (from a same session as of until point 5)</li></ol><div class="gatsby-highlight"><pre class="prism-code language-shell css-1wertj5 eiqe2b57" style="color:#F8F8F2;background-color:#282A36"><button class="css-1r5hp7i eiqe2b50">Copy</button><code><div class="token-line" style="color:#F8F8F2"><span class="token plain">airflow webserver</span></div></code></pre></div><a href="/posts/airflow2-dockeroperator-nodejs-gitlab/18.png" target="_blank" rel="noopener noreferrer"><img src="/posts/airflow2-dockeroperator-nodejs-gitlab/18.png" alt="airflow2-dockeroperator-nodejs-gitlab-18-png" align="left" style="margin-right:2rem;margin-bottom:1rem"/></a><ol start="8"><li><p>Login at the login prompt @IP:8080/localhost:8080 (Be sure that the port 8080 is open)</p><a href="/posts/airflow2-dockeroperator-nodejs-gitlab/19.png" target="_blank" rel="noopener noreferrer"><img src="/posts/airflow2-dockeroperator-nodejs-gitlab/19.png" alt="airflow2-dockeroperator-nodejs-gitlab-19-png" align="left" style="margin-right:2rem;margin-bottom:1rem"/></a></li><li><p>Airflow dashboard</p><a href="/posts/airflow2-dockeroperator-nodejs-gitlab/20.png" target="_blank" rel="noopener noreferrer"><img src="/posts/airflow2-dockeroperator-nodejs-gitlab/20.png" alt="airflow2-dockeroperator-nodejs-gitlab-20-png" align="left" style="margin-right:2rem;margin-bottom:1rem"/></a></li><li><p>This completes Apache Airflow 2 configuration</p></li></ol><hr/><h2 id="docker-20107" style="position:relative"><a href="#docker-20107" aria-label="docker 20107 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Docker 20.10.7</h2><ul><li><a href="https://docs.docker.com/engine/install/ubuntu/" target="_blank" rel="noopener noreferrer">Docker installation</a></li></ul><ol><li>Install docker 20.10.7</li></ol><div class="gatsby-highlight"><pre class="prism-code language-shell css-1wertj5 eiqe2b57" style="color:#F8F8F2;background-color:#282A36"><button class="css-1r5hp7i eiqe2b50">Copy</button><code><div class="token-line" style="color:#F8F8F2"><span class="token builtin class-name" style="color:rgb(189, 147, 249)">cd</span><span class="token plain"> /tmp </span><span class="token operator">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">curl</span><span class="token plain"> -fsSL https://get.docker.com -o get-docker.sh </span><span class="token operator">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">sh</span><span class="token plain"> get-docker.sh</span></div></code></pre></div><a href="/posts/airflow2-dockeroperator-nodejs-gitlab/21.png" target="_blank" rel="noopener noreferrer"><img src="/posts/airflow2-dockeroperator-nodejs-gitlab/21.png" alt="airflow2-dockeroperator-nodejs-gitlab-21-png" align="left" style="margin-right:2rem;margin-bottom:1rem"/></a><ol start="2"><li>Get the GID for the docker group</li></ol><div class="gatsby-highlight"><pre class="prism-code language-shell css-1wertj5 eiqe2b57" style="color:#F8F8F2;background-color:#282A36"><button class="css-1r5hp7i eiqe2b50">Copy</button><code><div class="token-line" style="color:#F8F8F2"><span class="token builtin class-name" style="color:rgb(189, 147, 249)">cd</span><span class="token plain"> ~ </span><span class="token operator">&amp;&amp;</span><span class="token plain"> getent group docker </span><span class="token operator">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">cut</span><span class="token plain"> -d: -f3</span></div></code></pre></div><a href="/posts/airflow2-dockeroperator-nodejs-gitlab/22.png" target="_blank" rel="noopener noreferrer"><img src="/posts/airflow2-dockeroperator-nodejs-gitlab/22.png" alt="airflow2-dockeroperator-nodejs-gitlab-22-png" align="left" style="margin-right:2rem;margin-bottom:1rem"/></a><ol start="3"><li><a href="https://www.howtogeek.com/50787/add-a-user-to-a-group-or-second-group-on-linux/" target="_blank" rel="noopener noreferrer">Add user to docker group</a></li></ol><div class="gatsby-highlight"><pre class="prism-code language-shell css-1wertj5 eiqe2b57" style="color:#F8F8F2;background-color:#282A36"><button class="css-1r5hp7i eiqe2b50">Copy</button><code><div class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">usermod</span><span class="token plain"> -aG docker ubuntu</span></div></code></pre></div><ol start="4"><li><a href="https://www.howtogeek.com/howto/ubuntu/see-which-groups-your-linux-user-belongs-to/" target="_blank" rel="noopener noreferrer">Verify user has been added to docker group</a></li></ol><div class="gatsby-highlight"><pre class="prism-code language-shell css-1wertj5 eiqe2b57" style="color:#F8F8F2;background-color:#282A36"><button class="css-1r5hp7i eiqe2b50">Copy</button><code><div class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">groups</span><span class="token plain"> ubuntu</span></div></code></pre></div><a href="/posts/airflow2-dockeroperator-nodejs-gitlab/23.png" target="_blank" rel="noopener noreferrer"><img src="/posts/airflow2-dockeroperator-nodejs-gitlab/23.png" alt="airflow2-dockeroperator-nodejs-gitlab-23-png" align="left" style="margin-right:2rem;margin-bottom:1rem"/></a><ol start="5"><li>Install requirements (you can also add this entry to your dags repo root in by <code class="inline-code">&amp;&amp; pip freeze &gt; requirements.txt</code> succeeding the below command)</li></ol><div class="gatsby-highlight"><pre class="prism-code language-shell css-1wertj5 eiqe2b57" style="color:#F8F8F2;background-color:#282A36"><button class="css-1r5hp7i eiqe2b50">Copy</button><code><div class="token-line" style="color:#F8F8F2"><span class="token plain">pip </span><span class="token function" style="color:rgb(80, 250, 123)">install</span><span class="token plain"> apache-airflow-providers-docker</span></div></code></pre></div><a href="/posts/airflow2-dockeroperator-nodejs-gitlab/24.png" target="_blank" rel="noopener noreferrer"><img src="/posts/airflow2-dockeroperator-nodejs-gitlab/24.png" alt="airflow2-dockeroperator-nodejs-gitlab-24-png" align="left" style="margin-right:2rem;margin-bottom:1rem"/></a><ol start="6"><li><a href="https://blog.usejournal.com/how-to-enable-docker-remote-api-on-docker-host-7b73bd3278c6" target="_blank" rel="noopener noreferrer">Enable docker remote API on docker host (comments section)</a></li></ol><div class="gatsby-highlight"><pre class="prism-code language-shell css-1wertj5 eiqe2b57" style="color:#F8F8F2;background-color:#282A36"><button class="css-1r5hp7i eiqe2b50">Copy</button><code><div class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">vim</span><span class="token plain"> /lib/systemd/system/docker.service</span></div></code></pre></div><div class="gatsby-highlight"><pre class="prism-code language-shell css-1wertj5 eiqe2b57" style="color:#F8F8F2;background-color:#282A36"><button class="css-1r5hp7i eiqe2b50">Copy</button><code><div class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"># Comment the original line for backup to revert if needed</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">#ExecStart=/usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">ExecStart</span><span class="token operator">=</span><span class="token plain">/usr/bin/dockerd -H fd:// -H </span><span class="token number">0.0</span><span class="token plain">.0.0:2375 --containerd</span><span class="token operator">=</span><span class="token plain">/run/containerd/containerd.sock</span></div></code></pre></div><ol start="7"><li>Reload - restart daemon and verify docker remote API response</li></ol><div class="gatsby-highlight"><pre class="prism-code language-shell css-1wertj5 eiqe2b57" style="color:#F8F8F2;background-color:#282A36"><button class="css-1r5hp7i eiqe2b50">Copy</button><code><div class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> systemctl daemon-reload</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">service</span><span class="token plain"> docker restart</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">curl</span><span class="token plain"> http://localhost:2375/images/json</span></div></code></pre></div><a href="/posts/airflow2-dockeroperator-nodejs-gitlab/25.png" target="_blank" rel="noopener noreferrer"><img src="/posts/airflow2-dockeroperator-nodejs-gitlab/25.png" alt="airflow2-dockeroperator-nodejs-gitlab-25-png" align="left" style="margin-right:2rem;margin-bottom:1rem"/></a><ol start="8"><li>This completes docker 20.10.7 installation and setup</li></ol><hr/><h2 id="gitlab-container-registry" style="position:relative"><a href="#gitlab-container-registry" aria-label="gitlab container registry permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Gitlab container registry</h2><ul><li><a href="https://docs.gitlab.com/ee/user/packages/container_registry/" target="_blank" rel="noopener noreferrer">About Gitlab container registry</a></li><li>This post uses connection to Gitlab container registry via docker remote API, without using connection from Airflow via the <code class="inline-code">docker_conn_id</code> parameter</li></ul><blockquote><p>Sample URLs where you can find container registry for your repo based on the repo being used for the post <br/>
<code class="inline-code">https://gitlab.com/blogs-imsheth-com/airflow2-dockeroperator-nodejs-gitlab/container_registry</code> <br/>
<code class="inline-code">https://gitlab.com/blogs-imsheth-com/airflow2-dockeroperator-nodejs-gitlab/-/settings/repository</code> <br/></p></blockquote><ol><li>Create sample project in Gitlab on your local machine<blockquote><p>Crete repo like <br/>
<code class="inline-code">https://gitlab.com/blogs-imsheth-com/airflow2-dockeroperator-nodejs-gitlab</code> <br/>
Add your deploy key at <br/>
<code class="inline-code">https://gitlab.com/blogs-imsheth-com/airflow2-dockeroperator-nodejs-gitlab/-/settings/repository#js-deploy-keys-settings</code> <br/>
Clone the repo <br/>
<code class="inline-code">https://gitlab.com/blogs-imsheth-com/airflow2-dockeroperator-nodejs-gitlab</code> <br/>
Copy paste sample code from <br/>
<code class="inline-code">https://github.com/imsheth/airflow2-dockeroperator-nodejs-gitlab</code> <br/>
Push to your repo <br/>
<code class="inline-code">git push origin master</code></p></blockquote></li></ol><a href="/posts/airflow2-dockeroperator-nodejs-gitlab/26.png" target="_blank" rel="noopener noreferrer"><img src="/posts/airflow2-dockeroperator-nodejs-gitlab/26.png" alt="airflow2-dockeroperator-nodejs-gitlab-26-png" align="left" style="margin-right:2rem;margin-bottom:1rem"/></a><ol start="2"><li><a href="https://docs.docker.com/engine/reference/commandline/login/#privileged-user-requirement" target="_blank" rel="noopener noreferrer">You need to login to the Gitlab container registry from docker on your local machine (this step also needs to be done on the server). Basically, this step generates the required file at `~/.docker/config.json`</a></li></ol><div class="gatsby-highlight"><pre class="prism-code language-shell css-1wertj5 eiqe2b57" style="color:#F8F8F2;background-color:#282A36"><button class="css-1r5hp7i eiqe2b50">Copy</button><code><div class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> docker login registry.gitlab.com</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">WARNING</span><span class="token operator">!</span><span class="token plain"> Your password will be stored unencrypted </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"> /root/.docker/config.json.</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">Configure a credential helper to remove this warning. See</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">https://docs.docker.com/engine/reference/commandline/login/</span><span class="token comment" style="color:rgb(98, 114, 164)">#credentials-store</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">Login Succeeded</span></div></code></pre></div><ol start="3"><li>Copy and update config json access on your local machine (this step also needs to be done on the server)</li></ol><div class="gatsby-highlight"><pre class="prism-code language-shell css-1wertj5 eiqe2b57" style="color:#F8F8F2;background-color:#282A36"><button class="css-1r5hp7i eiqe2b50">Copy</button><code><div class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">mkdir</span><span class="token plain"> ~/.docker </span><span class="token operator">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">cp</span><span class="token plain"> /root/.docker/config.json ~/.docker/config.json </span><span class="token operator">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">cat</span><span class="token plain"> ~/.docker/config.json </span><span class="token operator">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">chmod</span><span class="token plain"> </span><span class="token number">777</span><span class="token plain"> ~/.docker/config.json</span></div></code></pre></div><ol start="4"><li>Publish container to Gitlab from local from the root where Dockerfile is present (this will need the local docker daemon to be running, if not already then start it)</li></ol><div class="gatsby-highlight"><pre class="prism-code language-shell css-1wertj5 eiqe2b57" style="color:#F8F8F2;background-color:#282A36"><button class="css-1r5hp7i eiqe2b50">Copy</button><code><div class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> docker build -t registry.gitlab.com/blogs-imsheth-com/airflow2-dockeroperator-nodejs-gitlab </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">.</span><span class="token plain"> </span><span class="token operator">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> docker push registry.gitlab.com/blogs-imsheth-com/airflow2-dockeroperator-nodejs-gitlab</span></div></code></pre></div><a href="/posts/airflow2-dockeroperator-nodejs-gitlab/27.png" target="_blank" rel="noopener noreferrer"><img src="/posts/airflow2-dockeroperator-nodejs-gitlab/27.png" alt="airflow2-dockeroperator-nodejs-gitlab-27-png" align="left" style="margin-right:2rem;margin-bottom:1rem"/></a><a href="/posts/airflow2-dockeroperator-nodejs-gitlab/28.png" target="_blank" rel="noopener noreferrer"><img src="/posts/airflow2-dockeroperator-nodejs-gitlab/28.png" alt="airflow2-dockeroperator-nodejs-gitlab-28-png" align="left" style="margin-right:2rem;margin-bottom:1rem"/></a><ol start="5"><li>This completes Gitlab container registry installation and setup</li></ol><hr/><h2 id="airflow-dags" style="position:relative"><a href="#airflow-dags" aria-label="airflow dags permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Airflow DAGs</h2><ul><li>DAGs will run the nodejs code</li><li><a href="https://github.com/apache/airflow/blob/master/airflow/providers/docker/example_dags/example_docker.py" target="_blank" rel="noopener noreferrer">Sample DAG for DockerOperator</a></li><li><a href="https://github.com/imsheth/airflow2-dockeroperator-nodejs-gitlab" target="_blank" rel="noopener noreferrer">Clone your repo on server, source for current post can be found here</a></li></ul><ol><li>Activate virtual environment, clone at proper path, install dependencies</li></ol><div class="gatsby-highlight"><pre class="prism-code language-shell css-1wertj5 eiqe2b57" style="color:#F8F8F2;background-color:#282A36"><button class="css-1r5hp7i eiqe2b50">Copy</button><code><div class="token-line" style="color:#F8F8F2"><span class="token builtin class-name" style="color:rgb(189, 147, 249)">cd</span><span class="token plain"> airflow </span><span class="token operator">&amp;&amp;</span><span class="token plain"> </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">source</span><span class="token plain"> airflow_venv/bin/activate</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">cd</span><span class="token plain"> ~/dags_root/ </span><span class="token operator">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">git</span><span class="token plain"> clone https://github.com/imsheth/airflow2-dockeroperator-nodejs-gitlab </span><span class="token operator">&amp;&amp;</span><span class="token plain"> </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">cd</span><span class="token plain"> airflow2-dockeroperator-nodejs-gitlab/dags </span><span class="token operator">&amp;&amp;</span><span class="token plain"> pip </span><span class="token function" style="color:rgb(80, 250, 123)">install</span><span class="token plain"> -r requirements.txt</span></div></code></pre></div><a href="/posts/airflow2-dockeroperator-nodejs-gitlab/29.png" target="_blank" rel="noopener noreferrer"><img src="/posts/airflow2-dockeroperator-nodejs-gitlab/29.png" alt="airflow2-dockeroperator-nodejs-gitlab-29-png" align="left" style="margin-right:2rem;margin-bottom:1rem"/></a><ol start="2"><li><p>Your DAG is now available, first enable/unpause before triggering and then trigger it</p><a href="/posts/airflow2-dockeroperator-nodejs-gitlab/30.png" target="_blank" rel="noopener noreferrer"><img src="/posts/airflow2-dockeroperator-nodejs-gitlab/30.png" alt="airflow2-dockeroperator-nodejs-gitlab-30-png" align="left" style="margin-right:2rem;margin-bottom:1rem"/></a></li><li><p>Trigger your DAG run</p><a href="/posts/airflow2-dockeroperator-nodejs-gitlab/31.png" target="_blank" rel="noopener noreferrer"><img src="/posts/airflow2-dockeroperator-nodejs-gitlab/31.png" alt="airflow2-dockeroperator-nodejs-gitlab-31-png" align="left" style="margin-right:2rem;margin-bottom:1rem"/></a></li><li><p>DAG run successful</p><a href="/posts/airflow2-dockeroperator-nodejs-gitlab/32.png" target="_blank" rel="noopener noreferrer"><img src="/posts/airflow2-dockeroperator-nodejs-gitlab/32.png" alt="airflow2-dockeroperator-nodejs-gitlab-32-png" align="left" style="margin-right:2rem;margin-bottom:1rem"/></a></li><li><p>DAG run details for the successful run</p><a href="/posts/airflow2-dockeroperator-nodejs-gitlab/33.png" target="_blank" rel="noopener noreferrer"><img src="/posts/airflow2-dockeroperator-nodejs-gitlab/33.png" alt="airflow2-dockeroperator-nodejs-gitlab-33-png" align="left" style="margin-right:2rem;margin-bottom:1rem"/></a></li><li><p>DAG run task details graph view for the successful run</p><a href="/posts/airflow2-dockeroperator-nodejs-gitlab/34.png" target="_blank" rel="noopener noreferrer"><img src="/posts/airflow2-dockeroperator-nodejs-gitlab/34.png" alt="airflow2-dockeroperator-nodejs-gitlab-34-png" align="left" style="margin-right:2rem;margin-bottom:1rem"/></a></li><li><p>Task detail from DAG run task details graph view for the successful run</p><a href="/posts/airflow2-dockeroperator-nodejs-gitlab/35.png" target="_blank" rel="noopener noreferrer"><img src="/posts/airflow2-dockeroperator-nodejs-gitlab/35.png" alt="airflow2-dockeroperator-nodejs-gitlab-35-png" align="left" style="margin-right:2rem;margin-bottom:1rem"/></a></li><li><p>Task log from DAG run task details graph view for the successful run</p><a href="/posts/airflow2-dockeroperator-nodejs-gitlab/36.png" target="_blank" rel="noopener noreferrer"><img src="/posts/airflow2-dockeroperator-nodejs-gitlab/36.png" alt="airflow2-dockeroperator-nodejs-gitlab-36-png" align="left" style="margin-right:2rem;margin-bottom:1rem"/></a></li><li><p>This completes DAG run with DockerOperator in Airflow, however keep in mind that minimum AWS EC2 t2.medium equivalent instance will be required on the server to just run the DAGs with DockerOperator in Airflow </p></li></ol><hr/><h2 id="systemd-service" style="position:relative"><a href="#systemd-service" aria-label="systemd service permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>systemd service</h2><ul><li><a href="https://github.com/apache/airflow/tree/master/scripts/systemd" target="_blank" rel="noopener noreferrer">Sample scripts</a></li><li><a href="https://medium.com/@shahbaz.ali03/run-apache-airflow-as-a-service-on-ubuntu-18-04-server-b637c03f4722" target="_blank" rel="noopener noreferrer">Running Apache-Airflow as a service</a></li><li><a href="https://medium.com/@vando/airflow-inside-a-virtual-enviroment-and-integrated-with-systemd-3b6427bd6430" target="_blank" rel="noopener noreferrer">Running Apache-Airflow as a service in virtual environment</a></li><li><a href="https://www.freedesktop.org/software/systemd/man/systemd.service.html" target="_blank" rel="noopener noreferrer">systemd manual</a></li><li><a href="https://medium.com/@achilleus/easy-way-to-manage-your-airflow-setup-b7c030dd1cb8" target="_blank" rel="noopener noreferrer">Running Apache-Airflow as a service in virtual environment</a></li><li><a href="https://tech.akom.net/archives/93-Getting-a-systemd-unit-to-read-your-.bashrc-file-for-its-environment.html" target="_blank" rel="noopener noreferrer">systemd unit doesn&#x27;t interpolate variables and it will ignore lines starting with &quot;export&quot; in .bashrc</a></li></ul><ol><li>systemd unit doesn&#x27;t interpolate variables and it will ignore lines starting with &quot;export&quot; in .bashrc, which causes the issue on server restart as the variables are not exported (add the following to a startup script)</li></ol><div class="gatsby-highlight"><pre class="prism-code language-shell css-1wertj5 eiqe2b57" style="color:#F8F8F2;background-color:#282A36"><button class="css-1r5hp7i eiqe2b50">Copy</button><code><div class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">env</span><span class="token plain"> </span><span class="token operator">&gt;</span><span class="token plain"> /tmp/.magic-environment-file</span></div></code></pre></div><ol start="2"><li><a href="https://github.com/imsheth/airflow2-dockeroperator-nodejs-gitlab/tree/master/services" target="_blank" rel="noopener noreferrer">Service configurations</a></li></ol><div class="gatsby-highlight"><pre class="prism-code language-shell css-1wertj5 eiqe2b57" style="color:#F8F8F2;background-color:#282A36"><button class="css-1r5hp7i eiqe2b50">Copy</button><code><div class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">vim</span><span class="token plain"> /etc/systemd/system/airflow-webserver.service</span></div></code></pre></div><blockquote><p>[Unit]<!-- --> <br/>
Description=Airflow webserver daemon service template for Ubuntu 20.04.2 <br/>
After=network.target postgresql.service <br/>
Wants=postgresql.service <br/>
<!-- -->[Service]<!-- --> <br/>
#PIDFile=/run/airflow/webserver.pid <br/>
User=ubuntu <br/>
Group=ubuntu <br/>
Type=simple <br/>
EnvironmentFile=-/tmp/.magic-environment-file <br/>
ExecStart=/usr/bin/bash -c &#x27;source /home/ubuntu/airflow/airflow_venv/bin/activate ; /home/ubuntu/airflow/airflow_venv/bin/airflow db upgrade ; /home/&gt; ubuntu/airflow/airflow_venv/bin/airflow webserver&#x27; <br/>
Restart=on-failure <br/>
RestartSec=60s <br/>
PrivateTmp=true <br/>
<!-- -->[Install]<!-- --> <br/>
WantedBy=multi-user.target <br/></p></blockquote><div class="gatsby-highlight"><pre class="prism-code language-shell css-1wertj5 eiqe2b57" style="color:#F8F8F2;background-color:#282A36"><button class="css-1r5hp7i eiqe2b50">Copy</button><code><div class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">vim</span><span class="token plain"> /etc/systemd/system/airflow-scheduler.service</span></div></code></pre></div><blockquote><p>[Unit]<!-- --> <br/>
Description=Airflow scheduler daemon service template for Ubuntu 20.04.2 <br/>
After=network.target postgresql.service <br/>
Wants=postgresql.service <br/>
<!-- -->[Service]<!-- --> <br/>
#PIDFile=/run/airflow/scheduler.pid <br/>
User=ubuntu <br/>
Group=ubuntu <br/>
Type=simple <br/>
EnvironmentFile=-/tmp/.magic-environment-file <br/>
ExecStart=/usr/bin/bash -c &#x27;source /home/ubuntu/airflow/airflow_venv/bin/activate ; /home/ubuntu/airflow/airflow_venv/bin/airflow scheduler&#x27; <br/>
Restart=on-failure <br/>
RestartSec=60s <br/>
PrivateTmp=true <br/>
<!-- -->[Install]<!-- --> <br/>
WantedBy=multi-user.target <br/></p></blockquote><ol start="3"><li>Reload daemon, enable and start services</li></ol><div class="gatsby-highlight"><pre class="prism-code language-shell css-1wertj5 eiqe2b57" style="color:#F8F8F2;background-color:#282A36"><button class="css-1r5hp7i eiqe2b50">Copy</button><code><div class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> systemctl daemon-reload </span><span class="token operator">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> systemctl </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">enable</span><span class="token plain"> airflow-webserver.service </span><span class="token operator">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> systemctl </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">enable</span><span class="token plain"> airflow-scheduler.service </span><span class="token operator">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> systemctl start airflow-webserver.service </span><span class="token operator">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> systemctl start airflow-scheduler.service</span></div></code></pre></div><ol start="4"><li>Check service status</li></ol><div class="gatsby-highlight"><pre class="prism-code language-shell css-1wertj5 eiqe2b57" style="color:#F8F8F2;background-color:#282A36"><button class="css-1r5hp7i eiqe2b50">Copy</button><code><div class="token-line" style="color:#F8F8F2"><span class="token plain">systemctl status airflow-webserver.service</span></div></code></pre></div><a href="/posts/airflow2-dockeroperator-nodejs-gitlab/37.png" target="_blank" rel="noopener noreferrer"><img src="/posts/airflow2-dockeroperator-nodejs-gitlab/37.png" alt="airflow2-dockeroperator-nodejs-gitlab-37-png" align="left" style="margin-right:2rem;margin-bottom:1rem"/></a><ol start="5"><li>Check service status</li></ol><div class="gatsby-highlight"><pre class="prism-code language-shell css-1wertj5 eiqe2b57" style="color:#F8F8F2;background-color:#282A36"><button class="css-1r5hp7i eiqe2b50">Copy</button><code><div class="token-line" style="color:#F8F8F2"><span class="token plain">systemctl status airflow-scheduler.service</span></div></code></pre></div><a href="/posts/airflow2-dockeroperator-nodejs-gitlab/38.png" target="_blank" rel="noopener noreferrer"><img src="/posts/airflow2-dockeroperator-nodejs-gitlab/38.png" alt="airflow2-dockeroperator-nodejs-gitlab-38-png" align="left" style="margin-right:2rem;margin-bottom:1rem"/></a><ol start="6"><li>Checking sysetmd logs</li></ol><div class="gatsby-highlight"><pre class="prism-code language-shell css-1wertj5 eiqe2b57" style="color:#F8F8F2;background-color:#282A36"><button class="css-1r5hp7i eiqe2b50">Copy</button><code><div class="token-line" style="color:#F8F8F2"><span class="token plain">journalctl -xe</span></div></code></pre></div><ol start="7"><li><a href="https://unix.stackexchange.com/questions/225401/how-to-see-full-log-from-systemctl-status-service" target="_blank" rel="noopener noreferrer">Check full systemd logs</a></li></ol><div class="gatsby-highlight"><pre class="prism-code language-shell css-1wertj5 eiqe2b57" style="color:#F8F8F2;background-color:#282A36"><button class="css-1r5hp7i eiqe2b50">Copy</button><code><div class="token-line" style="color:#F8F8F2"><span class="token plain">journalctl -u airflow-webserver.service -e</span></div></code></pre></div><ol start="8"><li>Check live logs</li></ol><div class="gatsby-highlight"><pre class="prism-code language-shell css-1wertj5 eiqe2b57" style="color:#F8F8F2;background-color:#282A36"><button class="css-1r5hp7i eiqe2b50">Copy</button><code><div class="token-line" style="color:#F8F8F2"><span class="token plain">journalctl -u airflow-webserver.service -e -f</span></div></code></pre></div><hr/><h2 id="deployment" style="position:relative"><a href="#deployment" aria-label="deployment permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Deployment</h2><ol><li>This command can be added to your deployment pipeline</li></ol><div class="gatsby-highlight"><pre class="prism-code language-shell css-1wertj5 eiqe2b57" style="color:#F8F8F2;background-color:#282A36"><button class="css-1r5hp7i eiqe2b50">Copy</button><code><div class="token-line" style="color:#F8F8F2"><span class="token builtin class-name" style="color:rgb(189, 147, 249)">cd</span><span class="token plain"> /home/ubuntu/dags_root/airflow2-dockeroperator-nodejs-gitlab/dags </span><span class="token operator">&amp;&amp;</span><span class="token plain"> </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">source</span><span class="token plain"> /home/ubuntu/airflow/airflow_venv/bin/activate </span><span class="token operator">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">git</span><span class="token plain"> pull </span><span class="token operator">&amp;&amp;</span><span class="token plain"> pip </span><span class="token function" style="color:rgb(80, 250, 123)">install</span><span class="token plain"> -r /home/ubuntu/dags_root/airflow2-dockeroperator-nodejs-gitlab/dags/requirements.txt </span><span class="token operator">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> systemctl stop airflow-webserver.service </span><span class="token operator">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> systemctl start airflow-webserver.service </span><span class="token operator">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> systemctl stop airflow-scheduler.service </span><span class="token operator">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> systemctl start airflow-scheduler.service</span></div></code></pre></div><hr/><h2 id="unsuccessful-trials" style="position:relative"><a href="#unsuccessful-trials" aria-label="unsuccessful trials permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Unsuccessful trials</h2><ol><li>Trials with airflow2 inside docker</li></ol><ul><li><iframe width="100%" height="315" src="https://www.youtube-nocookie.com/embed/aTaytcxy2Ck?rel=0" frameBorder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></li><li><a href="https://airflow.apache.org/docs/apache-airflow/stable/docker-compose.yaml">https://airflow.apache.org/docs/apache-airflow/stable/docker-compose.yaml</a> with edits for permissions for docker installation, which failed miserably</li><li><a href="https://stackoverflow.com/questions/41381350/docker-compose-installing-requirements-txt">https://stackoverflow.com/questions/41381350/docker-compose-installing-requirements-txt</a></li><li><a href="https://stackoverflow.com/questions/45211594/running-a-custom-script-using-entrypoint-in-docker-compose">https://stackoverflow.com/questions/45211594/running-a-custom-script-using-entrypoint-in-docker-compose</a></li></ul><ol start="2"><li>Trials with airflow2 inside docker with DockerOperator (docker inside docker)</li></ol><ul><li><iframe width="100%" height="315" src="https://www.youtube-nocookie.com/embed/4_rQSkN1joA?rel=0" frameBorder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></li><li><a href="https://stackoverflow.com/questions/59765453/how-to-use-the-dockeroperator-from-apache-airflow">https://stackoverflow.com/questions/59765453/how-to-use-the-dockeroperator-from-apache-airflow</a></li></ul><ol start="3"><li>Referred initially but not used fully</li></ol><ul><li><a href="https://vujade.co/install-apache-airflow-ubuntu-18-04/">https://vujade.co/install-apache-airflow-ubuntu-18-04/</a></li><li><a href="https://towardsdatascience.com/setting-up-apache-airflow-2-with-docker-e5b974b37728">https://towardsdatascience.com/setting-up-apache-airflow-2-with-docker-e5b974b37728</a></li></ul><hr/><h2 id="miscellaneous" style="position:relative"><a href="#miscellaneous" aria-label="miscellaneous permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Miscellaneous</h2><ol><li>Purging all unused or dangling images, containers, volumes, and networks. This was used in research and development phase</li></ol><div class="gatsby-highlight"><pre class="prism-code language-shell css-1wertj5 eiqe2b57" style="color:#F8F8F2;background-color:#282A36"><button class="css-1r5hp7i eiqe2b50">Copy</button><code><div class="token-line" style="color:#F8F8F2"><span class="token plain">docker system prune -af</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">docker images -a</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">docker container </span><span class="token function" style="color:rgb(80, 250, 123)">ls</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">docker </span><span class="token function" style="color:rgb(80, 250, 123)">ps</span><span class="token plain"> -a</span></div></code></pre></div><ol start="2"><li><a href="https://airflow.apache.org/docs/apache-airflow-providers-docker/stable/_api/airflow/providers/docker/operators/docker/index.html" target="_blank" rel="noopener noreferrer">Important parameters for DockerOperator, which helped avoid commands in above point</a></li></ol><blockquote><p>Sample at <a href="https://github.com/imsheth/airflow2-dockeroperator-nodejs-gitlab/blob/master/dags/docker_provider.py">https://github.com/imsheth/airflow2-dockeroperator-nodejs-gitlab/blob/master/dags/docker_provider.py</a> <br/>
force_pull = True <br/>
xcom_all = True <br/>
auto_remove = True <br/>
tty = True <br/></p></blockquote><ol start="3"><li>SSH for deployment</li></ol><div class="gatsby-highlight"><pre class="prism-code language-shell css-1wertj5 eiqe2b57" style="color:#F8F8F2;background-color:#282A36"><button class="css-1r5hp7i eiqe2b50">Copy</button><code><div class="token-line" style="color:#F8F8F2"><span class="token plain">ssh-keygen -t rsa -b </span><span class="token number">2048</span><span class="token plain"> -C </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;john@thehightable.org&quot;</span></div></code></pre></div><ol start="4"><li>Add to repo for deploy keys</li></ol><div class="gatsby-highlight"><pre class="prism-code language-shell css-1wertj5 eiqe2b57" style="color:#F8F8F2;background-color:#282A36"><button class="css-1r5hp7i eiqe2b50">Copy</button><code><div class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">cat</span><span class="token plain"> id_rsa.pub</span></div></code></pre></div><ol start="5"><li>For running DAGs with DockerOperator</li></ol><ul><li><a href="https://github.com/docker/for-mac/issues/770#issuecomment-252560286" target="_blank" rel="noopener noreferrer">Docker for Mac doesn&#x27;t listen on 2375</a></li><li><a href="https://github.com/docker/docker-py/issues/1916" target="_blank" rel="noopener noreferrer">docker.from_env() causes TypeError: load_config() got an unexpected keyword argument &#x27;config_dict&#x27;</a></li></ul><ol start="6"><li>Gitlab registry</li></ol><ul><li><a href="https://stackoverflow.com/questions/58733579/airflow-pull-docker-image-from-private-google-container-repository" target="_blank" rel="noopener noreferrer">Airflow pull docker image from private google container repository</a></li><li><a href="https://stackoverflow.com/a/65219624/3152654" target="_blank" rel="noopener noreferrer">No Docker registry URL provided</a></li></ul><ol start="7"><li>docker remote API</li></ol><ul><li><a href="https://blog.usejournal.com/how-to-enable-docker-remote-api-on-docker-host-7b73bd3278c6" target="_blank" rel="noopener noreferrer">Enabling docker remote API</a></li></ul><div class="gatsby-highlight"><pre class="prism-code language-shell css-1wertj5 eiqe2b57" style="color:#F8F8F2;background-color:#282A36"><button class="css-1r5hp7i eiqe2b50">Copy</button><code><div class="token-line" style="color:#F8F8F2"><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">ExecStart</span><span class="token operator">=</span><span class="token plain">/usr/bin/dockerd -H fd:// -H </span><span class="token number">0.0</span><span class="token plain">.0.0:2375 --containerd</span><span class="token operator">=</span><span class="token plain">/run/containerd/containerd.sock</span></div></code></pre></div><ul><li><a href="https://www.redhat.com/sysadmin/getting-started-socat" target="_blank" rel="noopener noreferrer">Connecting to docker remote API via socat</a></li></ul><div class="gatsby-highlight"><pre class="prism-code language-shell css-1wertj5 eiqe2b57" style="color:#F8F8F2;background-color:#282A36"><button class="css-1r5hp7i eiqe2b50">Copy</button><code><div class="token-line" style="color:#F8F8F2"><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">DOCKER_GROUP_ID</span><span class="token operator">=</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">`</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">getent group docker </span><span class="token variable operator" style="color:rgb(189, 147, 249);font-style:italic">|</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic"> </span><span class="token variable function" style="color:rgb(80, 250, 123);font-style:italic">cut</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic"> -d: -f3</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">`</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> docker-compose up -d</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">docker run -d -v /var/run/docker.sock:/var/run/docker.sock -p </span><span class="token number">127.0</span><span class="token plain">.0.1:2375:2375 bobrik/socat TCP-LISTEN:2375,fork UNIX-CONNECT:/var/run/docker.sock</span></div></code></pre></div><ol start="8"><li>macOS issues</li></ol><ul><li><a href="https://github.com/apache/airflow/issues/10435" target="_blank" rel="noopener noreferrer">Negsignal.SIGKILL error on macOS</a></li><li><a href="https://stackoverflow.com/a/59828133/3152654" target="_blank" rel="noopener noreferrer">Airflow task running tweepy exits with return code -6</a></li><li><a href="https://stackoverflow.com/a/52230415/3152654" target="_blank" rel="noopener noreferrer">Multiprocessing causes Python to crash and gives an error may have been in progress in another thread when fork() was called</a></li></ul><ol start="7"><li>Check docker container logs</li></ol><div class="gatsby-highlight"><pre class="prism-code language-shell css-1wertj5 eiqe2b57" style="color:#F8F8F2;background-color:#282A36"><button class="css-1r5hp7i eiqe2b50">Copy</button><code><div class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> docker </span><span class="token function" style="color:rgb(80, 250, 123)">ps</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> docker </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">exec</span><span class="token plain"> -it 82f4b968cb6d </span><span class="token function" style="color:rgb(80, 250, 123)">sh</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> docker-compose logs --tail</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;all&quot;</span><span class="token plain"> -f</span></div></code></pre></div><p><code class="inline-code">#airflow</code> <code class="inline-code">#airflow2</code> <code class="inline-code">#apacheairflow</code> <code class="inline-code">#apacheairflow2.0.1</code> <code class="inline-code">#dockeroperator</code> <code class="inline-code">#docker</code> <code class="inline-code">#python</code> <code class="inline-code">#python3.6</code> <code class="inline-code">#pip</code> <code class="inline-code">#pip20.2.4</code> <code class="inline-code">#ubuntu</code> <code class="inline-code">#ubuntu20.04.2lts</code> <code class="inline-code">#tech</code></p><hr/><div style="text-align:left;margin-top:0.55rem;margin-bottom:0.40rem">
  <a href="https://twitter.com/theimsheth" target="_blank" rel="noopener noreferrer" style="text-decoration:none">
    <img src="/social/twitter.svg" alt="twitter" style="height:32px;width:32px;margin:.2rem"/>
  </a>
  <a href="https://github.com/imsheth" target="_blank" rel="noopener noreferrer" style="text-decoration:none">
    <img src="/social/github.svg" alt="github" style="height:32px;width:32px;margin:.2rem"/>
  </a>
  <a href="https://www.npmjs.com/~imsheth" target="_blank" rel="noopener noreferrer" style="text-decoration:none">
    <img src="/social/npm.svg" alt="npm" style="height:32px;width:32px;margin:.2rem"/>
  </a>
  <a href="https://stackoverflow.com/users/3152654/imsheth?tab=profile" target="_blank" rel="noopener noreferrer" style="text-decoration:none">
    <img src="/social/stackoverflow.svg" alt="stackoverflow" style="height:32px;width:32px;margin:.2rem"/>
  </a>
  <a href="https://in.linkedin.com/in/imsheth" target="_blank" rel="noopener noreferrer" style="text-decoration:none">
    <img src="/social/linkedin.svg" alt="linkedin" style="height:32px;width:32px;margin:.2rem"/>
  </a>
  <a href="https://instagram.com/imsheth/" target="_blank" rel="noopener noreferrer" style="text-decoration:none">
    <img src="/social/instagram.svg" alt="instagram" style="height:32px;width:32px;margin:.2rem"/>
  </a>
  <a href="https://www.facebook.com/imsheth" target="_blank" rel="noopener noreferrer" style="text-decoration:none">
    <img src="/social/facebook.svg" alt="facebook" style="height:32px;width:32px;margin:.2rem"/>
  </a>
  <a href="https://open.spotify.com/user/orekqqr23uij1ehi7upg9akat?si=xXA0ZUqxQW2GgFYzdXgAOA&amp;nd=1" target="_blank" rel="noopener noreferrer" style="text-decoration:none">
    <img src="/social/spotify.svg" alt="spotify" style="height:32px;width:32px;margin:.2rem"/>
  </a>
  <a href="https://www.tvshowtime.com/1589595" target="_blank" rel="noopener noreferrer" style="text-decoration:none">
    <img src="/social/tvtime.svg" alt="tvshowtime" style="height:32px;width:32px;margin:.2rem"/>
  </a>
  
</div><hr/><br/><style data-emotion="css 1vvt293">.css-1vvt293{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-text-decoration:none;text-decoration:none;margin-top:48px;color:#6C6C80;opacity:0.8;font-size:14px;font-weight:normal;}</style><a href="https://github.com/imsheth/imsheth.github.io/tree/main/src/docs/posts/tags/tech/airflow2-dockeroperator-nodejs-gitlab.mdx" target="_blank" rel="noopener noreferrer" class="css-1vvt293"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" style="margin-right:5px" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"></path></svg>Edit this page on <!-- -->GitHub</a><style data-emotion="css ns1hxi">.css-ns1hxi{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:48px 0;width:100%;}@media (max-width: 780px){.css-ns1hxi{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}}</style><section class="css-ns1hxi e1jikabl1"><style data-emotion="css 10sjsqn">.css-10sjsqn{-webkit-transition:all 200ms;transition:all 200ms;margin-left:auto;}.css-10sjsqn a{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-text-decoration:none;text-decoration:none;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;width:100%;height:100%;}.css-10sjsqn a svg{width:25px;height:25px;color:#6C6C80;margin-left:16px;}.css-10sjsqn a p{letter-spacing:0.142em;text-transform:uppercase;font-size:12px;margin:0;color:#6C6C80;}.css-10sjsqn a h3{color:#6C6C80;border:none;margin:0;padding:0;font-size:16px;}.css-10sjsqn:hover{opacity:0.8;}.css-10sjsqn:hover a svg{opacity:0.8;}@media (max-width: 780px){.css-10sjsqn{width:100%;}.css-10sjsqn a{-webkit-box-pack:end;-ms-flex-pack:end;-webkit-justify-content:flex-end;justify-content:flex-end;}}</style><div class="css-10sjsqn e1jikabl0"><a href="/"><div><p>Next</p><h3>Meta</h3></div><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M8.59 16.34l4.58-4.59-4.58-4.59L10 5.75l6 6-6 6z"></path></svg></a></div></section></div><style data-emotion="css 106zi9a">.css-106zi9a{position:-webkit-sticky;position:sticky;top:0;-webkit-order:2;-ms-flex-order:2;order:2;padding-top:72px;max-height:calc(100vh - 72px);overflow-y:auto;overflow-x:hidden;width:100%;max-width:200px;}@media (max-width: 1200px){.css-106zi9a{position:relative;top:auto;-webkit-order:0;-ms-flex-order:0;order:0;max-width:100%;margin-left:0;padding-top:0;}}</style><div class="css-106zi9a e10o0eax1"><style data-emotion="css 1gnn5iw">.css-1gnn5iw h2{text-transform:uppercase;font-size:14px;font-weight:bold;letter-spacing:0.142em;margin-top:0rem;border:none;margin:0 0 16px 0;}.css-1gnn5iw nav ul{padding-left:0;margin-bottom:0;list-style:none;}.css-1gnn5iw nav ul li{margin-bottom:12px;line-height:1.1;}.css-1gnn5iw nav ul li a{font-size:14px;font-weight:400;-webkit-text-decoration:none;text-decoration:none;-webkit-transition:all 0.2s;transition:all 0.2s;overflow-wrap:break-word;}.css-1gnn5iw nav ul li a:hover{-webkit-text-decoration:underline;text-decoration:underline;}@media (max-width: 1200px){.css-1gnn5iw{margin:0 0 24px 0;padding-bottom:16px;border-bottom:1px solid rgba(120, 117, 122, 0.2);}}</style><div class="css-1gnn5iw e10o0eax0"><h2>On this page</h2><nav><ul><li><a href="#ubuntu-20xx" style="color:#6C6C80">Ubuntu 20.x.x</a></li><li><a href="#python-36" style="color:#6C6C80">python 3.6</a></li><li><a href="#airflow-201" style="color:#6C6C80">Airflow 2.0.1</a></li><li><a href="#postgres-12" style="color:#6C6C80">Postgres 12</a></li><li><a href="#airflow-201-config" style="color:#6C6C80">Airflow 2.0.1 config</a></li><li><a href="#docker-20107" style="color:#6C6C80">Docker 20.10.7</a></li><li><a href="#gitlab-container-registry" style="color:#6C6C80">Gitlab container registry</a></li><li><a href="#airflow-dags" style="color:#6C6C80">Airflow DAGs</a></li><li><a href="#systemd-service" style="color:#6C6C80">systemd service</a></li><li><a href="#deployment" style="color:#6C6C80">Deployment</a></li><li><a href="#unsuccessful-trials" style="color:#6C6C80">Unsuccessful trials</a></li><li><a href="#miscellaneous" style="color:#6C6C80">Miscellaneous</a></li></ul></nav></div></div></main></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-29341891-1', 'auto', {});
      
      
      
      
      
      }</script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/posts/tags/tech/airflow2-dockeroperator-nodejs-gitlab";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-080a75688ac44a95c783.js"],"app":["/app-604b17e51c593e9714e6.js"],"component---cache-caches-gatsby-plugin-offline-app-shell-js":["/component---cache-caches-gatsby-plugin-offline-app-shell-js-af80383ef3e4f9de1a8b.js"],"component---node-modules-rocketseat-gatsby-theme-docs-core-src-templates-docs-query-js":["/component---node-modules-rocketseat-gatsby-theme-docs-core-src-templates-docs-query-js-c880f3a4d9d09789db84.js"],"component---node-modules-rocketseat-gatsby-theme-docs-core-src-templates-homepage-query-js":["/component---node-modules-rocketseat-gatsby-theme-docs-core-src-templates-homepage-query-js-f14717849d330410c51b.js"],"component---src-pages-404-js":["/component---src-pages-404-js-739d2134f4e34d8ad4bf.js"]};/*]]>*/</script><script src="/polyfill-080a75688ac44a95c783.js" nomodule=""></script><script src="/component---node-modules-rocketseat-gatsby-theme-docs-core-src-templates-docs-query-js-c880f3a4d9d09789db84.js" async=""></script><script src="/a7629950cb7a18c7593baf47d0acfe798f1cddc4-39eb6eaf15cd62012732.js" async=""></script><script src="/252f366e-60c4f5aff3b5bf89cf6c.js" async=""></script><script src="/5e2a4920-9d393d3fc1d166c1df23.js" async=""></script><script src="/545f34e4-2b9fd36d84b7bf8ea9b9.js" async=""></script><script src="/app-604b17e51c593e9714e6.js" async=""></script><script src="/f0e45107-c14585455e99ce9e9e51.js" async=""></script><script src="/framework-b46a6925e6a7b8d3b87f.js" async=""></script><script src="/webpack-runtime-06b2d0ff5ad089d23a10.js" async=""></script></body></html>